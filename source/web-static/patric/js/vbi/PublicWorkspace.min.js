Ext.define("VBI.Workspace.model.ExpressionExperiment",{extend:"Ext.data.Model",idProperty:"expid",fields:["accession","author","condition","description",{name:"eid",type:"int"},"expid","genes","institution","mutant","organism","pi",{name:"platforms",type:"int"},"pmid","release_date",{name:"samples",type:"int"},"strain","timeseries","title","source","origFileName","desc","cdate","mdate","data_type"]});Ext.define("VBI.Workspace.model.ExpressionSample",{extend:"Ext.data.Model",idProperty:"pid",fields:["accession",{name:"channels",type:"int"},"condition",{name:"eid",type:"int"},{name:"expmean",type:"float"},"expname",{name:"expstddev",type:"float"},{name:"genes",type:"int"},"mutant","organism","pid","platform","release_date","samples",{name:"sig_log_ratio",type:"int"},{name:"sig_z_score",type:"int"},"strain","timepoint","organism","source"]});Ext.define("VBI.Workspace.store.ExpressionExperiments",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ExpressionExperiment",model:"VBI.Workspace.model.ExpressionExperiment",autoLoad:true,proxy:{type:"ajax",actionMethods:{read:"POST"},api:{read:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getPublicExperiments"},extraParams:{trackIds:""},reader:{type:"json",root:"results",totalProperty:"total"},writer:{type:"json",writeAllFields:false,root:"experiment_info",encode:true},noCache:false},pageSize:20,remoteSort:false,filterByTracks:function(a){if(Ext.isArray(a)){this.getProxy().extraParams.trackIds=a.join(",");this.load()}else{if(Ext.isNumber(a)){this.getProxy().extraParams.trackIds=a;this.load()}}}});Ext.define("VBI.Workspace.store.ExpressionSamples",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ExpressionSample",model:"VBI.Workspace.model.ExpressionSample",autoLoad:false,proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport",extraParams:{action:"getPublicSamples"},reader:{type:"json",root:"results",totalProperty:"total"},startParam:undefined,limitParam:undefined,pageParam:undefined,noCache:false},remoteSort:false});Ext.define("VBI.Workspace.view.columns.HeaderContainer",{applyColumnsState:function(e){if(!e||!e.length){return}var l=this,j=l.items.items,h=j.length,f=0,b=e.length,k,d,a,g;for(k=0;k<b;k++){a=e[k];for(g=h;g--;){d=j[g];if(d.itemId==a.id){if(f!==g){l.moveHeader(g,f)}if(d.applyColumnState){d.applyColumnState(a)}++f;break}}}},getColumnsState:function(){var b=this,a=[],c;b.items.each(function(d){c=d.getColumnState&&d.getColumnState();if(c){c.id=d.itemId;a.push(c)}});return a}});function renderExperimentTitle(e,d,a,f,c,b){return Ext.String.format('<a href="javascript:void(0);" onclick="launchExperimentDetail(\'{1}\')">{0}</a>',e,a.get("expid"))}function renderGeneCount(e,d,a,f,c,b){if(a.get("source")!="PATRIC"){return e}if(e!=0){return Ext.String.format('<a href="TranscriptomicsGene?cType=&cId=&dm=result&expId={1}&sampleId=&log_ratio=0&zscore=0">{0}</a>',e,a.get("eid"))}else{return 0}}function renderPubmedID(e,d,a,f,c,b){if(e!=undefined&&e!=""){return Ext.String.format('<a href="http://www.ncbi.nlm.nih.gov/pubmed/{0}" target="_blank">{0}</a>',e)}else{return""}}Ext.define("VBI.Workspace.view.columns.ExpressionExperiment",{defaults:{align:"center",draggable:false,resizable:false},items:[{text:"Source",itemId:"Experiment_source",dataIndex:"source",flex:1,align:"left"},{text:"Data Type",itemId:"Experiment_datatype",dataIndex:"data_type",flex:1,align:"left"},{text:"Title",itemId:"Experiment_title",dataIndex:"title",flex:4,align:"left",renderer:renderExperimentTitle},{text:"Comparisons",itemId:"Experiment_samples",dataIndex:"samples",flex:1},{text:"Genes",itemId:"Experiment_genes",dataIndex:"genes",flex:1,renderer:renderGeneCount},{text:"PubMed",itemId:"Experiment_pmid",dataIndex:"pmid",flex:1,renderer:renderPubmedID},{text:"Organism",itemId:"Experiment_organism",dataIndex:"organism",flex:3,align:"left",renderer:BasicRenderer}]});function linkToGeneList(e,d,a,f,c,b){if(a.get("source")!="PATRIC"){return e}if(e!=0){return Ext.String.format('<a href="TranscriptomicsGene?cType=&cId=&dm=result&expId={1}&sampleId={2}&log_ratio={3}&zscore={4}">{0}</a>',e,a.get("eid"),a.get("pid"),0,0)}else{return 0}}function linkToGeneListFold(e,d,a,f,c,b){if(a.get("source")!="PATRIC"){return e}if(e!=0){return Ext.String.format('<a href="TranscriptomicsGene?cType=&cId=&dm=result&expId={1}&sampleId={2}&log_ratio={3}&zscore={4}">{0}</a>',e,a.get("eid"),a.get("pid"),1,0)}else{return 0}}function linkToGeneListZScore(e,d,a,f,c,b){if(a.get("source")!="PATRIC"){return e}if(e!=0){return Ext.String.format('<a href="TranscriptomicsGene?cType=&cId=&dm=result&expId={1}&sampleId={2}&log_ratio={3}&zscore={4}">{0}</a>',e,a.get("eid"),a.get("pid"),0,2)}else{return 0}}Ext.define("VBI.Workspace.view.columns.ExpressionSample",{defaults:{align:"center",draggable:false,resizable:false},items:[{text:"Accession",itemId:"Sample_accession",dataIndex:"accession",flex:1,align:"left",hidden:true},{text:"Title",itemId:"Sample_expname",dataIndex:"expname",flex:4,align:"left",renderer:BasicRenderer},{text:"Genes",itemId:"Sample_genes",dataIndex:"genes",flex:1,renderer:linkToGeneList},{text:"Significant genes(Log Ratio)",itemId:"Sample_sig_log_ratio",dataIndex:"sig_log_ratio",flex:1,renderer:linkToGeneListFold},{text:"Significant genes(Z Score)",itemId:"Sample_sig_z_score",dataIndex:"sig_z_score",flex:1,renderer:linkToGeneListZScore},{text:"Organism",itemId:"Sample_organism",dataIndex:"organism",flex:1,align:"left",hidden:true,renderer:BasicRenderer},{text:"Strain",itemId:"Sample_strain",dataIndex:"strain",flex:1,align:"left",renderer:BasicRenderer},{text:"Gene Modification",itemId:"Sample_mutant",dataIndex:"mutant",flex:1,align:"left",renderer:BasicRenderer},{text:"Experimental Condition",itemId:"Sample_condision",dataIndex:"condition",flex:1,align:"left",renderer:BasicRenderer},{text:"Time Point",itemId:"Sample_timepoint",dataIndex:"timepoint",flex:1,align:"left",renderer:BasicRenderer}]});Ext.define("VBI.Workspace.view.columns.HeaderContainer",{applyColumnsState:function(e){if(!e||!e.length){return}var l=this,j=l.items.items,h=j.length,f=0,b=e.length,k,d,a,g;for(k=0;k<b;k++){a=e[k];for(g=h;g--;){d=j[g];if(d.itemId==a.id){if(f!==g){l.moveHeader(g,f)}if(d.applyColumnState){d.applyColumnState(a)}++f;break}}}},getColumnsState:function(){var b=this,a=[],c;b.items.each(function(d){c=d.getColumnState&&d.getColumnState();if(c){c.id=d.itemId;a.push(c)}});return a}});Ext.define("VBI.Workspace.view.group.DetailToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.detailtoolbar",items:[{text:"<font color=#fff><b>All Groups</b></font>",iconCls:"leftarrow",overCls:"",pressedCls:"",style:{"background-color":"#0a4773"},minWidth:95,itemId:"backButton",scope:this}]});Ext.define("VBI.Workspace.view.group.ExperimentInfoEditor",{extend:"Ext.form.Panel",alias:"widget.experimentinfoeditor",width:225,minWidth:225,bodyPadding:5,cls:"x-infoeditor-view",fieldDefaults:{labelAlign:"left",anchor:"100%",labelStyle:"font-weight:bold"},items:[{xtype:"displayfield",itemId:"title",name:"title",hideLabel:true,fieldStyle:{fontSize:"15px",fontWeight:"bold"},style:{marginBottom:"0px"}},{xtype:"displayfield",name:"samples",hideLabel:true,fieldStyle:{paddingTop:"0px"}},{xtype:"displayfield",value:"Transcriptomics Experiment",fieldStyle:{paddingBottom:"5px",borderTop:"1px dashed #000000",borderBottom:"1px dashed #000000"}},{xtype:"displayfield",name:"organism",itemId:"organism",fieldLabel:"Platform Organism",labelAlign:"top"},{xtype:"displayfield",name:"pmid",itemId:"pmid",fieldLabel:"Pubmed ID",labelWidth:80,renderer:function(b,a){return Ext.String.format('<a href="http://www.ncbi.nlm.nih.gov/pubmed/{0}" target=_blank>{0}</a>',b)}},{xtype:"displayfield",name:"description",itemId:"description",fieldLabel:"Description",labelAlign:"top"},{xtype:"displayfield",name:"updated",fieldLabel:"Last modified",labelWidth:90,value:"none"},{xtype:"displayfield",name:"created",fieldLabel:"Uploaded",labelWidth:70,value:"none"},{xtype:"displayfield",name:"file",fieldLabel:"Source file",labelWidth:70,value:"none"}],loadRecord:function(a){this.record=a;var b;if(a.get("samples")>1){b="("+a.get("samples")+" comparisons)"}else{b="("+a.get("samples")+" comparison)"}this.getForm().setValues({title:a.get("title"),samples:b,description:a.get("desc"),organism:a.get("organism"),pmid:(a.get("pmid")!=0)?a.get("pmid"):"",updated:Ext.Date.format(Ext.Date.parse(a.get("mdate"),"Y-m-d H:i:s"),"M j, Y"),created:Ext.Date.format(Ext.Date.parse(a.get("cdate"),"Y-m-d H:i:s"),"M j, Y"),file:a.get("origFileName")})}});Ext.define("VBI.Workspace.view.selection.CheckboxModel",{extend:"Ext.selection.CheckboxModel",getHeaderConfig:function(){var a=this,b=a.showHeaderCheckbox!==false;return{itemId:a.itemId,isCheckerHd:b,text:"&#160;",width:a.headerWidth,sortable:false,draggable:false,resizable:false,hideable:false,menuDisabled:true,dataIndex:"",cls:b?Ext.baseCSSPrefix+"column-header-checkbox ":"",renderer:Ext.Function.bind(a.renderer,a),editRenderer:a.editRenderer||a.renderEmpty,locked:a.hasLockedHeader()}}});Ext.define("VBI.Workspace.view.toolbar.ExpressionExperiment",{extend:"Ext.toolbar.Toolbar",alias:"widget.expressionexperimenttoolbar",getSelectedID:function(c){var b=Ext.getCmp("workspace_listview_expview").child("#experimentview").getSelectionModel().getSelection();if(b.length==0){Ext.Msg.alert("Alert","No experiment was selected");return null}else{var a=new Array();Ext.Array.each(b,function(d){if(c!=undefined){a.push(d.get(c))}else{a.push(d.get("expid"))}});return a}},layout:{type:"hbox",align:"stretch"},items:[{title:"View",xtype:"buttongroup",width:115,items:[{xtype:"tbar_btn_genelist",handler:function(a,d){var i=a.findParentByType("toolbar").getSelectedID(),c=new Array(),h=new Array(),j=Ext.getStore("ExpressionExperiments"),g=0,f=100,b;Ext.Array.each(i,function(e){item=j.getById(e);g+=item.get("samples");h.push(item.get("expid"))});if(g>=f){alert("You have exceeded the limit of comparisons. Please lower than "+f);return false}b="&expId="+c.join(",")+"&sampleId=&colId="+h.join(",");if(c.length>0||h.length>0){this.fireEvent("runGeneList",b)}}}]},{title:"Download",xtype:"buttongroup",width:115,items:[{scale:"small",iconAlign:"left",width:110,text:"Table",icon:"/patric/images/toolbar_table.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_tb_txt",handler:function(){this.fireEvent("downloadGrid","txt")}},{xtype:"tbar_menu_dn_tb_xls",handler:function(){this.fireEvent("downloadGrid","xlsx")}}]}]},"->","-",{xtype:"tbar_btngrp_help"}]});Ext.define("VBI.Workspace.view.toolbar.ExpressionSample",{extend:"Ext.toolbar.Toolbar",alias:"widget.expressionsampletoolbar",getSelectedID:function(){var b=Ext.getCmp("workspace_detailview").child("#panel_grid").child("#experimentdetail").getSelectionModel().getSelection();if(b.length==0){Ext.Msg.alert("Alert","No sample was selected");return null}else{var a=new Array();Ext.Array.each(b,function(c){a.push(c.get("pid"))});return a}},layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",scale:"small",iconAlign:"left",text:"<< Experiment list",handler:function(a,b){this.fireEvent("viewExpList")}},{xtype:"tbspacer",width:112},{title:"View",xtype:"buttongroup",width:115,columns:1,items:[{xtype:"tbar_btn_genelist",handler:function(c,g){var d=c.findParentByType("toolbar").getSelectedID(),f=Ext.getCmp("workspace_experimentinfoeditor").record.get("expid"),b=Ext.getStore("ExpressionExperiments"),a=100,h="";console.log(d);if(d!=undefined){if(d.length>=a){alert("You have exceeded the limit of comparisons. Please lower than "+a);return false}h="&expId=&sampleId=&colId="+f+":"+d.join("+").replace(new RegExp(f,"g"),"");this.fireEvent("runGeneList",h)}}}]},{title:"Download",xtype:"buttongroup",width:115,items:[{scale:"small",iconAlign:"left",width:110,text:"Table",icon:"/patric/images/toolbar_table.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_tb_txt",handler:function(){this.fireEvent("downloadGrid","txt")}},{xtype:"tbar_menu_dn_tb_xls",handler:function(){this.fireEvent("downloadGrid","xlsx")}}]}]},"->","-",{xtype:"tbar_btngrp_help"}]});Ext.define("VBI.Workspace.view.toolbar.Paging",{extend:"Ext.toolbar.Paging",alias:"widget.patricpagingtoolbar",beforePageSizeText:"Show",afterPageSizeText:"per page",displayMsg:"Displaying record {0} - {1} of {2}",displayInfo:true,maxPageSize:5000,maskOnDisable:true,getPagingItems:function(){var a=this;return[{itemId:"first",tooltip:a.firstText,overflowText:a.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",disabled:true,handler:a.moveFirst,scope:a},{itemId:"prev",tooltip:a.prevText,overflowText:a.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:true,handler:a.movePrevious,scope:a},"-",a.beforePageText,{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,hideTrigger:true,enableKeyEvents:true,keyNavEnabled:false,selectOnFocus:true,submitValue:false,width:a.inputItemWidth,margins:"-1 2 3 2",listeners:{scope:a,keydown:a.onPagingKeyDown,blur:a.onPagingBlur}},{xtype:"tbtext",itemId:"afterTextItem",text:Ext.String.format(a.afterPageText,1)},"-",{itemId:"next",tooltip:a.nextText,overflowText:a.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:true,handler:a.moveNext,scope:a},{itemId:"last",tooltip:a.lastText,overflowText:a.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",disabled:true,handler:a.moveLast,scope:a},"->","-",a.beforePageSizeText,{xtype:"numberfield",itemId:"pagesize",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,maxValue:64000,hideTrigger:true,enableKeyEvents:true,selectOnFocus:true,submitValue:false,width:50,margins:"-1 2 3 2",value:a.pageSize,stateful:true,stateId:"pagesize",stateEvents:["savePageSize"],applyState:function(b){if(b!=undefined&&b.value!=undefined){if(a.maxPageSize<b.value){this.setValue(a.maxPageSize)}else{a.store.pageSize=b.value;this.setValue(b.value)}}},initComponent:function(){var b=this;if(b.allowOnlyWhitespace===false){b.allowBlank=false}b.callParent();b.addEvents("autosize","keydown","keyup","keypress","change");b.setGrowSizePolicy();if(Ext.state.Manager.get("pagesize")==undefined||Ext.state.Manager.get("pagesize").value==undefined){b.setValue(20)}},listeners:{scope:a,specialKey:function(f,d){if(d.getKey()==d.ENTER){var c=f.getValue(),b=c===null;if(b==false){a.updateStore()}}}}},a.afterPageSizeText,{itemId:"refresh",text:"Apply",style:{"border-color":"#81a4d0","background-color":"#dbeeff","background-image":"-webkit-linear-gradient(top,#dbeeff,#d0e7ff 48%,#bbd2f0 52%,#bed6f5)"},handler:function(){a.updateStore()},scope:a},"-",{itemId:"saveState",text:"Apply to ALL tables",style:{"border-color":"#81a4d0","background-color":"#dbeeff","background-image":"-webkit-linear-gradient(top,#dbeeff,#d0e7ff 48%,#bbd2f0 52%,#bed6f5)"},handler:function(){if(a.updateStore()!=false){a.child("#pagesize").fireEvent("savePageSize");var b=new Date();b.setTime(b.getTime()+1000);while(new Date().getTime()<b.getTime()){}}},scope:a},"-"]},showMessageTip:function(d,c){var a=this,b=Ext.create("Ext.tip.QuickTip",{target:a.child("#pagesize").el,closable:true,autoHide:false,anchor:"bottom",bodyPadding:10,title:d,html:c}).show()},updateStore:function(){var c=this,a=c.getStore(),b=c.child("#pagesize").getValue();if(b>c.maxPageSize){this.showMessageTip("Warning","Maximum number of visible rows must be smaller than "+c.maxPageSize+".");return false}else{if(b!=a.pageSize){a.currentPage=1;a.pageSize=b;a.load()}}},initComponent:function(){var a=this;if(a.store!=null&&typeof a.store=="string"){a.store=Ext.getStore(a.store)}if(a.store!=null&&a.store.pageSize!=null){if(typeof a.store.pageSize=="string"){a.pageSize=parseInt(a.store.pageSize)}else{if(typeof a.store.pageSize=="number"){a.pageSize=a.store.pageSize}}}this.callParent()},listeners:{afterlayout:function(c,d){var b=c.child("#pagesize"),a=Ext.state.Manager.get("pagesize");if(a!=undefined&&a.value!=undefined){if(b.value!=a.value){b.setValue(a.value);c.updateStore()}}}}});Ext.define("VBI.Workspace.view.DetailView",{extend:"Ext.panel.Panel",alias:"widget.detailview",requires:["VBI.Workspace.view.group.ExperimentInfoEditor","VBI.Workspace.view.toolbar.ExpressionSample","VBI.Workspace.view.selection.CheckboxModel"],border:false,layout:"border",items:[{itemId:"panel_info",region:"west",xtype:"panel",layout:"card",border:false,activeItem:"experimentinfo",items:[{itemId:"experimentinfo",xtype:"experimentinfoeditor",id:"workspace_experimentinfoeditor"}]},{itemId:"panel_toolbar",region:"north",xtype:"panel",layout:"card",border:false,activeItem:"experiment",items:[{itemId:"experiment",xtype:"expressionexperimenttoolbar",id:"expressionexperimenttoolbar"},{itemId:"sample",xtype:"expressionsampletoolbar"}]},{itemId:"panel_grid",region:"center",xtype:"panel",layout:"card",border:false,activeItem:"experimentview",items:[{itemId:"experimentview",xtype:"gridpanel",store:"ExpressionExperiments",border:false,columns:Ext.create("VBI.Workspace.view.columns.ExpressionExperiment"),stateId:"experimentlist",stateEvents:["hide","show","columnmove","columnresize"],dockedItems:[{xtype:"patricpagingtoolbar",store:"ExpressionExperiments",dock:"bottom",displayInfo:true}],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})},{itemId:"experimentdetail",xtype:"gridpanel",store:"ExpressionSamples",border:false,columns:Ext.create("VBI.Workspace.view.columns.ExpressionSample"),stateId:"comparisonlist",stateEvents:["hide","show","columnmove","columnresize"],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})}]}]});Ext.define("VBI.Workspace.view.ListView",{extend:"Ext.panel.Panel",alias:"widget.listview",requires:["VBI.Workspace.view.toolbar.ExpressionExperiment","VBI.Workspace.view.columns.ExpressionExperiment","VBI.Workspace.view.selection.CheckboxModel"],border:false,layout:"border",items:[{xtype:"panel",region:"center",layout:"card",activeItem:"experimentview",id:"workspace_listview_expview",flex:1,border:false,items:[{itemId:"experimentview",xtype:"gridpanel",store:"ExpressionExperiments",border:false,columns:Ext.create("VBI.Workspace.view.columns.ExpressionExperiment"),stateful:true,stateId:"experimentlist",stateEvents:["hide","show","columnmove","columnresize"],dockedItems:[{xtype:"expressionexperimenttoolbar",dock:"top"},{xtype:"patricpagingtoolbar",store:"ExpressionExperiments",dock:"bottom"}],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})}]}]});Ext.define("VBI.Workspace.view.Toolbar.button.GeneList",{extend:"Ext.Button",alias:"widget.tbar_btn_genelist",scale:"small",iconAlign:"left",text:"Gene List",width:110,icon:"/patric/images/toolbar_icon_genelist.png"});Ext.define("VBI.Workspace.view.Toolbar.button.ShowHide",{extend:"Ext.Button",alias:"widget.tbar_btn_showhide",scale:"large",iconAlign:"left",icon:"/patric/images/toolbar_hideshow.png",text:"Show/Hide"});Ext.define("VBI.Workspace.view.Toolbar.button.ResetColumnState",{extend:"Ext.Button",alias:"widget.tbar_btn_resetcolumnstate",scale:"large",iconAlign:"left",text:"Reset<br/>Configs"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_Table_Txt",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_tb_txt",scale:"small",iconAlign:"left",text:"Text File (.txt)",icon:"/patric/images/toolbar_text.png"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_Table_Xls",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_tb_xls",scale:"small",iconAlign:"left",text:"Excel file (.xlsx)",icon:"/patric/images/toolbar_excel.png"});Ext.define("VBI.Workspace.view.Toolbar.buttongroup.Help",{extend:"Ext.container.ButtonGroup",alias:"widget.tbar_btngrp_help",title:"Help",items:[{scale:"small",text:"PATRIC FAQs",icon:"/patric/images/toolbar_faq_small.png",handler:function(){window.open("http://enews.patricbrc.org/faqs/","_new","menubar=1,resizable=1,scrollbars=1, fullscreen=1, toolbar=1,titlebar=1,status=1")}}]});Ext.define("VBI.Workspace.view.Viewport",{extend:"Ext.container.Viewport",requires:["VBI.Workspace.view.Toolbar","VBI.Workspace.view.toolbar.Paging","VBI.Workspace.view.ListView","VBI.Workspace.view.DetailView"],layout:"border",items:[{region:"center",xtype:"panel",layout:"border",items:[{region:"center",xtype:"panel",id:"workspace_view",layout:"card",activeItem:"listview",border:false,items:[{itemId:"listview",xtype:"listview",id:"workspace_listview",},{itemId:"detailview",xtype:"detailview",id:"workspace_detailview"}]}]}],onRender:function(){var a=this;a.callParent(arguments);a.width=Ext.Element.getViewportWidth()-15;a.height=Math.max(580,Ext.Element.getViewportHeight()-320)},initComponent:function(){var c=this,a=document.body.parentNode,b;c.callParent(arguments);c.el=b=Ext.get("wksp")},fireResize:function(b,a){if(b!=this.width||a!=this.height){this.setSize(b-15,Math.max(580,a-320))}}});Ext.define("VBI.Workspace.controller.Experiment",{extend:"Ext.app.Controller",init:function(){this.control({"expressionexperimenttoolbar button":{runGeneList:this.runGeneList},"expressionexperimenttoolbar menuitem":{downloadGrid:this.downloadExperiments},"expressionsampletoolbar button":{runGeneList:this.runGeneList,viewExpList:this.viewExperimentList},"expressionsampletoolbar menuitem":{downloadGrid:this.downloadSamples},detailview:{viewExpDetail:this.viewExperimentDetail}})},runGeneList:function(a){document.location.href="/portal/portal/patric/TranscriptomicsGene?cType=&cId=&dm=result&log_ratio=&zscore="+a},viewExperimentList:function(){Ext.getCmp("workspace_view").getLayout().setActiveItem("listview")},viewExperimentDetail:function(b){var c=Ext.getCmp("workspace_detailview");c.child("#panel_info").getLayout().setActiveItem("experimentinfo");c.child("#panel_toolbar").getLayout().setActiveItem("sample");c.child("#panel_grid").getLayout().setActiveItem("experimentdetail");Ext.getStore("ExpressionSamples").getProxy().setExtraParam("expid",b);Ext.getStore("ExpressionSamples").load();var a=Ext.getStore("ExpressionExperiments").getById(b);Ext.getCmp("workspace_experimentinfoeditor").loadRecord(a);Ext.getCmp("workspace_view").getLayout().setActiveItem("detailview")},downloadExperiments:function(c){var a=Ext.getStore("ExpressionExperiments"),b=new Array();Ext.Array.each(a.getRange(),function(e){b.push(e.internalId)});var d={USERExperiments:b};Ext.getDom("fTableForm").action="/patric-searches-and-tools/jsp/grid_download_handler.jsp";Ext.getDom("fTableForm").target="";Ext.getDom("tablesource").value="Workspace";Ext.getDom("fileformat").value=c;Ext.getDom("idType").value="ExpressionExperiment";Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getToken",success:function(e){d.token=e.responseText;Ext.getDom("fids").value=Ext.JSON.encode(d);Ext.getDom("fTableForm").submit()}})},downloadSamples:function(b){var a=Ext.getStore("ExpressionSamples"),d=Ext.getCmp("workspace_experimentinfoeditor").record,c={source:d.get("source"),eid:d.get("eid"),expId:d.get("expid")};Ext.getDom("fTableForm").action="/patric-searches-and-tools/jsp/grid_download_handler.jsp";Ext.getDom("fTableForm").target="";Ext.getDom("tablesource").value="Workspace";Ext.getDom("fileformat").value=b;Ext.getDom("idType").value="ExpressionSample";Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getToken",success:function(e){c.token=e.responseText;Ext.getDom("fids").value=Ext.JSON.encode(c);Ext.getDom("fTableForm").submit()}})}});Ext.Loader.setConfig({enabled:true});Ext.application({name:"VBI.Workspace",autoCreateViewport:true,init:function(){},launch:function(){Ext.fly(document.body).setStyle("overflow","auto")},id:"workspace",models:["ExpressionExperiment","ExpressionSample"],stores:["ExpressionExperiments","ExpressionSamples"],controllers:["Experiment"]});function BasicRenderer(e,d,a,f,c,b){d.tdAttr='data-qtip="'+e+'" data-qclass="x-tip"';return e}function launchExperimentDetail(a){Ext.getCmp("workspace_detailview").fireEvent("viewExpDetail",a)};
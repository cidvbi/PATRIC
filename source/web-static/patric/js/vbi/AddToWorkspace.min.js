var popup,signup_popup;function addSelectedItems(a){Ext.Ajax.request({method:"GET",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=LoginStatus&action=getLoginStatus",success:function(b,c){if(b.responseText=="false"){Ext.Ajax.request({method:"GET",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=PopupShowedStatus&action=getPopupStatus",success:function(d,e){if(d.responseText=="false"){if(!signup_popup){signup_popup=getSignUpPopupWindow(a);signup_popup.show()}}else{DecideToShowPopup(a)}}})}else{setPopupStatus(a)}}})}function DecideToShowPopup(a){if(!popup){popup=getCartWindow(a).show()}else{Ext.getCmp("ATGform").resetValues();store.load();popup.show()}Ext.Ajax.request({method:"GET",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=LoginStatus&action=getLoginStatus",success:function(b,c){if(b.responseText=="true"){Ext.getCmp("ATGform").child("#noteToUser").setVisible(false)}}})}function saveToGroup(c,a){var b=Ext.getCmp("ATGform");popup.hide();Ext.Ajax.request({method:"POST",params:{group_name:b.child("#groupName").getValue(),group_desc:b.child("#groupDesc").getValue(),group_type:a,tracks:c,tags:b.child("#groupTag").getValue(),group_element:b.child("#groupElement").getValue()},url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=create",success:function(d,e){updateCartInfo()}});return true}Ext.define("WorkspaceGroups",{extend:"Ext.data.Store",fields:["name","description","tags"],proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getGroupList",startParam:undefined,limitParam:undefined,pageParam:undefined,nocache:false,reader:{type:"json"}},listeners:{beforeload:function(c,a,b){c.proxy.extraParams.group_type=c.group_type},load:function(c,a,d,b){if(d){c.insert(0,{name:"Create New Group"});c.insert(0,{name:"None"})}}},autoLoad:true});Ext.define("AddToWorkspace",{extend:"Ext.form.Panel",alias:"widget.addtoworkspace",border:false,bodyPadding:10,fieldDefaults:{labelWidth:80,anchor:"100%"},items:[{xtype:"radiogroup",itemId:"groupElement",columns:2,vertical:false,hidden:true,items:[{boxLabel:"Save as Feature Group",name:"groupElement",inputValue:"Feature",checked:true,listeners:{focus:{fn:function(c,f,d){var b=c.up("form");var a=b.child("#atg");a.getStore().group_type="Feature";a.getStore().load()}}}},{boxLabel:"Save as Genome Group",name:"groupElement",inputValue:"Genome",listeners:{focus:{fn:function(c,f,d){var b=c.up("form");var a=b.child("#atg");a.getStore().group_type="Genome";a.getStore().load()}}}}]},{xtype:"combobox",itemId:"atg",fieldLabel:"Add to group",store:"WorkspaceGroups",editable:false,displayField:"name",valueField:"name",listeners:{added:function(b,a){b.select("None")},change:function(d,e,b,a){var c=d.up("form");if(b==undefined){return false}if(e=="None"){c.child("#groupName").setDisabled(true);c.child("#groupDesc").setDisabled(true)}else{if(e=="Create New Group"){c.child("#groupName").setDisabled(false);c.child("#groupName").setValue("");c.child("#groupName").focus();c.child("#groupName").setReadOnly(false);c.child("#groupDesc").setDisabled(false);c.child("#groupDesc").setValue("");c.child("#groupTag").setValue("")}else{record=d.getStore().findRecord("name",e,undefined,undefined,undefined,true);c.child("#groupName").setDisabled(false);c.child("#groupName").setValue(record.get("name"));c.child("#groupName").setReadOnly(true);c.child("#groupDesc").setDisabled(false);c.child("#groupDesc").setValue(record.get("description"));c.child("#groupDesc").setReadOnly(true);c.child("#groupTag").setValue(record.get("tags"))}}}}},{xtype:"textfield",itemId:"groupName",name:"group_name",emptyText:"New group name",disabled:true},{xtype:"textareafield",itemId:"groupDesc",name:"group_desc",emptyText:"Description",disabled:true},{xtype:"textfield",itemId:"groupTag",name:"tags",fieldLabel:"Tags",emptyText:"(comma separated)"},{xtype:"displayfield",itemId:"noteToUser",value:'<br/><u>Note:</u> As Guest, your Workspace items persist until you close your browser.To save your Workspace items, <a target="_blank" href="https://www.patricbrc.org/portal/portal/patric/MyAccount/PATRICUserPortletWindow?_jsfBridgeViewId=%2Fjsf%2Findex.xhtml&amp;action=1">register</a> or <a href="javascript:LoginonPopupClick();">login</a>.'}],resetValues:function(){var a=this;a.child("#groupName").setValue("");a.child("#groupDesc").setValue("");a.child("#groupTag").setValue("");a.child("#atg").select("None")}});function getCartWindow(b){var a=$Page,c=a.getCartSaveButton();store=Ext.create("WorkspaceGroups",{id:"WorkspaceGroups",group_type:b});popup=Ext.create("Ext.Window",{layout:"fit",width:350,closeAction:"hide",modal:true,title:"Add Selected "+b+"(s) to Workspace",items:[{xtype:"addtoworkspace",id:"ATGform"}],buttons:[c,{text:"Cancel",handler:function(){popup.hide()}}],workspace_type:b});if(b=="Feature"){popup.child("#ATGform").child("#groupElement").setVisible(true)}return popup}function getSignUpPopupWindow(a){signup_popup=Ext.create("Ext.Window",{closeAction:"hide",modal:true,width:330,title:"WANT TO SAVE WORKSPACE ITEMS?",items:[{xtype:"panel",bodyPadding:7,border:false,items:[{xtype:"displayfield",value:"WANT TO SAVE <br/> WORKSPACE ITEMS?",fieldStyle:{fontSize:"16px",fontWeight:"bold",textAlign:"center"}},{xtype:"imagecomponent",src:"/patric/images/horizonal_rule_302x2.png"},{xtype:"displayfield",value:"Login to your PATRIC Account",fieldStyle:{fontSize:"14px",fontWeight:"bold"}},{xtype:"component",autoEl:{tag:"div",id:"window_login-modal",html:'<div id="window_login-modal-msg" style="width:255px;height:109px"><div id="window_loginIframe" class="login-content"></div></div>'},padding:"5 25px"},{xtype:"imagecomponent",src:"/patric/images/horizonal_rule_OR_302x9.png"},{xtype:"displayfield",value:"Register @ PATRIC",fieldStyle:{fontSize:"14px",fontWeight:"bold"}},{xtype:"displayfield",value:'<a target="_blank" href="https://www.patricbrc.org/portal/portal/patric/MyAccount/PATRICUserPortletWindow?_jsfBridgeViewId=%2Fjsf%2Findex.xhtml&amp;action=1">Sign up</a> for a PATRIC account to save custom sets of workspace genomes and more <br> <a target="_blank" href="http://enews.patricbrc.org/faqs/workspace-faqs/registration-faqs/" style="float: right;padding: 0px 20px;">Learn more</a>'},{xtype:"imagecomponent",src:"/patric/images/horizonal_rule_OR_302x9.png"},{xtype:"displayfield",value:"Work as Guest",fieldStyle:{fontSize:"14px",fontWeight:"bold"}},{xtype:"displayfield",value:'As Guest, your Workspace items persists until you close your browser.<br> <input style="width:120px; height:20px; top: 1px; padding: 0px 13px; position:relative; left: 180px; cursor: pointer;" onclick="javascript:setPopupStatus(\''+a+'\');return false;" value="Continue as Guest" class="login-button" />'}]}],listeners:{hide:function(){setPopupStatus(a)},show:function(){PopupModalLoading=true;alertModal("login-modal","login-modal-msg",window.location.href.replace("portal/portal","portal/auth/portal"))}}});return signup_popup}function LoginonPopupClick(){popup.hide();alertModal("login-modal","login-modal-msg",window.location.href.replace("portal/portal","portal/auth/portal"))}function setPopupStatus(a){PopupModalLoading=false;isPopupModalLoaded=true;if(signup_popup!=null){signup_popup.destroy()}Ext.Ajax.request({method:"GET",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=PopupShowedStatus&action=setPopupStatus",success:function(b,c){DecideToShowPopup(a)}})}function getLoginUpPopupWindow(b,a,c){Ext.create("Ext.Window",{modal:true,width:330,title:b,items:[{xtype:"panel",bodyPadding:7,border:false,items:[{xtype:"displayfield",value:a,fieldStyle:{fontSize:"16px",fontWeight:"bold",textAlign:"center"}},{xtype:"imagecomponent",src:"/patric/images/horizonal_rule_302x2.png"},{xtype:"displayfield",value:"Login to your PATRIC Account",fieldStyle:{fontSize:"14px",fontWeight:"bold"}},{xtype:"component",autoEl:{tag:"div",id:"window_login-modal",html:'<div id="window_login-modal-msg" style="width:255px;height:109px"><div id="window_loginIframe" class="login-content"></div></div>'},padding:"5 25px"},{xtype:"imagecomponent",src:"/patric/images/horizonal_rule_OR_302x9.png"},{xtype:"displayfield",value:c,fieldStyle:{fontSize:"14px",fontWeight:"bold"}},{xtype:"displayfield",value:'<a target="_blank" href="https://www.patricbrc.org/portal/portal/patric/MyAccount/PATRICUserPortletWindow?_jsfBridgeViewId=%2Fjsf%2Findex.xhtml&amp;action=1">Sign up</a> for a PATRIC account to save custom sets of workspace genomes and more <br> <a target="_blank" href="http://enews.patricbrc.org/faqs/workspace-faqs/registration-faqs/" style="float: right;padding: 0px 20px;">Learn more</a>'}]}],listeners:{show:function(e,d){PopupModalLoading=true;alertModal("login-modal","login-modal-msg",window.location.href.replace("portal/portal","portal/auth/portal"));PopupModalLoading=false}}}).show()};
Ext.define("VBI.Workspace.model.ColumnBrowser",{extend:"Ext.data.Model",idProperty:"tagId",fields:[{name:"tagId",type:"int"},"name","tagType","type"]});Ext.define("VBI.Workspace.model.ExpressionExperiment",{extend:"Ext.data.Model",idProperty:"expid",fields:["accession","author","condition","description",{name:"eid",type:"int"},"expid","genes","institution","mutant","organism","pi",{name:"platforms",type:"int"},"pmid","release_date",{name:"samples",type:"int"},"strain","timeseries","title","source","origFileName","desc","cdate","mdate","data_type"]});Ext.define("VBI.Workspace.model.ExpressionSample",{extend:"Ext.data.Model",idProperty:"pid",fields:["accession",{name:"channels",type:"int"},"condition",{name:"eid",type:"int"},{name:"expmean",type:"float"},"expname",{name:"expstddev",type:"float"},{name:"genes",type:"int"},"mutant","organism","pid","platform","release_date","samples",{name:"sig_log_ratio",type:"int"},{name:"sig_z_score",type:"int"},"strain","timepoint","organism","source"]});Ext.define("VBI.Workspace.model.Feature",{extend:"Ext.data.Model",idProperty:"na_feature_id",fields:[{name:"genome_info_id",type:"int"},{name:"gid",type:"int"},{name:"genome_name",type:"string"},{name:"accession",type:"string"},{name:"locus_tag",type:"string"},{name:"na_feature_id",type:"int"},{name:"annotation",type:"string"},{name:"feature_type",type:"string"},{name:"start_max",type:"int"},{name:"end_min",type:"int"},{name:"na_length",type:"int"},{name:"strand",type:"string"},{name:"protein_id",type:"string"},{name:"aa_length",type:"int"},{name:"gene",type:"string"},{name:"is_pseudo",type:"string"},{name:"bound_moiety",type:"string"},{name:"anticodon",type:"string"},{name:"product",type:"string"},{name:"refseq_locus_tag",type:"string"},{name:"pseed_id",type:"string"}]});Ext.define("VBI.Workspace.model.Genome",{extend:"Ext.data.Model",idProperty:"genome_info_id",fields:[{name:"genome_name",type:"string"},{name:"genome_info_id",type:"int"},{name:"gid",type:"int"},{name:"genome_status",type:"string"},{name:"isolation_country",type:"string"},{name:"host_name",type:"string"},{name:"oxygen_requirement",type:"string"},{name:"sporulation",type:"string"},{name:"temperature_range",type:"string"},{name:"disease",type:"string"},{name:"habitat",type:"string"},{name:"motility",type:"string"},{name:"sequences",type:"int"},{name:"collection_date",type:"string"},{name:"genome_length",type:"int"},{name:"complete",type:"string"},{name:"rast_cds",type:"int"},{name:"brc_cds",type:"int"},{name:"refseq_cds",type:"int"},{name:"chromosomes",type:"int"},{name:"plasmids",type:"int"},{name:"contigs",type:"int"},{name:"ncbi_tax_id",type:"int"},{name:"organism_name",type:"string"},{name:"strain",type:"string"},{name:"serovar",type:"string"},{name:"biovar",type:"string"},{name:"pathovar",type:"string"},{name:"culture_collection",type:"string"},{name:"type_strain",type:"string"},{name:"project_status",type:"string"},{name:"availability",type:"string"},{name:"sequencing_centers",type:"string"},{name:"completion_date",type:"string"},{name:"publication",type:"string"},{name:"completion_date",type:"string"},{name:"ncbi_project_id",type:"int"},{name:"refseq_project_id",type:"int"},{name:"genbank_accessions",type:"string"},{name:"refseq_accessions",type:"string"},{name:"sequencing_status",type:"string"},{name:"sequencing_platform",type:"string"},{name:"sequencing_depth",type:"string"},{name:"assembly_method",type:"string"},{name:"gc_content",type:"string"},{name:"isolation_site",type:"string"},{name:"isolation_source",type:"string"},{name:"isolation_comments",type:"string"},{name:"geographic_location",type:"string"},{name:"latitude",type:"string"},{name:"longitude",type:"string"},{name:"altitude",type:"string"},{name:"depth",type:"string"},{name:"host_gender",type:"string"},{name:"host_age",type:"string"},{name:"host_health",type:"string"},{name:"body_sample_site",type:"string"},{name:"body_sample_subsite",type:"string"},{name:"gram_stain",type:"string"},{name:"cell_shape",type:"string"},{name:"temperature_range",type:"string"},{name:"optimal_temperature",type:"string"},{name:"salinity",type:"string"},{name:"disease",type:"string"},{name:"comments",type:"string"},{name:"highlight"}]});Ext.define("VBI.Workspace.model.Group",{extend:"Ext.data.Model",idProperty:"tagId",fields:[{name:"tagId",type:"int"},"name",{name:"members",type:"int"},"cdate","mdate","desc","type",{name:"thumb",convert:function(b,a){return"/patric/images/workspace_"+a.get("type").toLowerCase()+"_group.png"}}]});Ext.define("VBI.Workspace.model.Mapping",{extend:"Ext.data.Model",fields:[{name:"trackId",type:"int"},{name:"tagId",type:"int"}]});Ext.define("VBI.Workspace.model.Station",{extend:"Ext.data.Model",idProperty:"id",fields:["id","name","type","leaf",{name:"iconCls",type:"string",defaultValue:"x-tree-noicon"}]});Ext.define("VBI.Workspace.store.ColumnBrowser.Groups",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ColumnBrowser",model:"VBI.Workspace.model.ColumnBrowser"});Ext.define("VBI.Workspace.store.ColumnBrowser.Tags",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ColumnBrowser",model:"VBI.Workspace.model.ColumnBrowser",filterByTag:function(a){this.clearFilter();this.filter([Ext.create("Ext.util.Filter",{filterFn:function(b){return Ext.Array.contains(a,b.get("tagId"))}})])}});Ext.define("VBI.Workspace.store.ColumnBrowser",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ColumnBrowser",model:"VBI.Workspace.model.ColumnBrowser",autoLoad:true,proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getFacets",reader:{type:"json",root:"results"},noCache:false},refresh:function(a){Ext.getStore("ColumnBrowser.Groups").removeAll(false);Ext.getStore("ColumnBrowser.Tags").removeAll(false);this.load(a)},listeners:{load:function(a){a.clearFilter();a.filter("tagType","Group");Ext.getStore("ColumnBrowser.Groups").add(a.getRange());a.clearFilter();a.filter("tagType","String");Ext.getStore("ColumnBrowser.Tags").add(a.getRange())}}});Ext.define("VBI.Workspace.store.ExpressionExperiments",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ExpressionExperiment",model:"VBI.Workspace.model.ExpressionExperiment",autoLoad:true,proxy:{type:"ajax",actionMethods:{read:"POST"},api:{read:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getExperiments",update:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=updateExperimentInfo"},extraParams:{trackIds:""},reader:{type:"json",root:"results",totalProperty:"total"},writer:{type:"json",writeAllFields:false,root:"experiment_info",encode:true},noCache:false},pageSize:20,remoteSort:false,filterByTracks:function(a){if(Ext.isArray(a)){this.getProxy().extraParams.trackIds=a.join(",");this.load()}else{if(Ext.isNumber(a)){this.getProxy().extraParams.trackIds=a;this.load()}}}});Ext.define("VBI.Workspace.store.ExpressionSamples",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ExpressionSample",model:"VBI.Workspace.model.ExpressionSample",autoLoad:false,proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport",extraParams:{action:"getSamples",expsource:"User"},reader:{type:"json",root:"results",totalProperty:"total"},startParam:undefined,limitParam:undefined,pageParam:undefined,noCache:false},remoteSort:false});Ext.define("VBI.Workspace.store.Features",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.Feature",model:"VBI.Workspace.model.Feature",autoLoad:true,proxy:{type:"ajax",actionMethods:{read:"POST"},url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getFeatures",extraParams:{trackIds:""},reader:{type:"json",root:"results",totalProperty:"total"},noCache:false},pageSize:20,stateId:"workspace_pagesize",remoteSort:true,filterByTracks:function(a){if(Ext.isArray(a)){this.getProxy().extraParams.trackIds=a.join(",");this.load()}else{if(Ext.isNumber(a)){this.getProxy().extraParams.trackIds=a;this.load()}}}});Ext.define("VBI.Workspace.store.Genomes",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.Genome",model:"VBI.Workspace.model.Genome",autoLoad:true,proxy:{type:"ajax",actionMethods:{read:"POST"},url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getGenomes",extraParams:{trackIds:""},reader:{type:"json",root:"results",totalProperty:"total"},noCache:false},pageSize:20,stateId:"workspace_pagesize",remoteSort:true,filterByTracks:function(a){if(Ext.isArray(a)){this.getProxy().extraParams.trackIds=a.join(",");this.load()}else{if(Ext.isNumber(a)){this.getProxy().extraParams.trackIds=a;this.load()}}}});Ext.define("VBI.Workspace.store.Groups",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.Group",model:"VBI.Workspace.model.Group",autoLoad:true,proxy:{type:"ajax",api:{read:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getGroups",update:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=updateGroupInfo"},reader:{type:"json",successProperty:"success",root:"results"},writer:{type:"json",writeAllFields:false,root:"group_info",encode:true},noCache:false},listeners:{write:function(b,a){Ext.getStore("ColumnBrowser").refresh()}},filterByTag:function(a){this.clearFilter();this.filter([Ext.create("Ext.util.Filter",{filterFn:function(b){return Ext.Array.contains(a,b.get("tagId"))}})])}});Ext.define("VBI.Workspace.store.Mappings",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.Mapping",model:"VBI.Workspace.model.Mapping",autoLoad:true,proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getMappings",noCache:false},filterCriteria:{Group:[],String:[]},setTrackFilter:function(b,a){if(b=="Group"){this.filterCriteria.Group=a}else{if(b=="String"){this.filterCriteria.String=a}}},getFilteredTracks:function(){var b=new Array();var d=new Array();var c=new Array();if(!Ext.isEmpty(this.filterCriteria.Group)){var a=Ext.Array.merge(this.filterCriteria.Group);this.each(function(e){if(Ext.Array.contains(a,e.get("tagId"))){d.push(e.get("trackId"))}})}if(!Ext.isEmpty(this.filterCriteria.String)){var a=Ext.Array.merge(this.filterCriteria.String);this.each(function(e){if(Ext.Array.contains(a,e.get("tagId"))){c.push(e.get("trackId"))}})}if(!Ext.isEmpty(d)&&!Ext.isEmpty(c)){if(d.length<c.length){Ext.Array.each(d,function(e){if(Ext.Array.contains(c,e)){b.push(e)}})}else{Ext.Array.each(c,function(e){if(Ext.Array.contains(d,e)){b.push(e)}})}}else{if(!Ext.isEmpty(c)&&Ext.isEmpty(d)){b=c}else{if(!Ext.isEmpty(d)&&Ext.isEmpty(c)){b=d}else{this.each(function(e){b.push(e.get("trackId"))})}}}return b},getTagsByTrack:function(b){var a=new Array();if(Ext.isArray(b)){this.each(function(c){if(Ext.Array.contains(b,c.get("trackId"))){a.push(c.get("tagId"))}})}else{if(Ext.isNumber(tracks)){this.each(function(c){if(c.get("trackId")==b){a.push(c.get("tagId"))}})}}a=Ext.Array.unique(a);return a}});Ext.override(Ext.data.TreeStore,{load:function(b){b=b||{};b.params=b.params||{};var d=this,c=b.node||d.tree.getRootNode(),a;if(!c){c=d.setRootNode({expanded:true})}if(d.clearOnLoad){c.removeAll(false)}Ext.applyIf(b,{node:c});b.params[d.nodeParam]=c?c.getId():"root";if(c){c.set("loading",true)}return d.callParent([b])}});Ext.define("VBI.Workspace.store.Stations",{extend:"Ext.data.TreeStore",requires:"VBI.Workspace.model.Station",model:"VBI.Workspace.model.Station",autoLoad:false,proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getLibrary",noCache:false}});Ext.define("VBI.Workspace.view.columns.HeaderContainer",{applyColumnsState:function(e){if(!e||!e.length){return}var l=this,j=l.items.items,h=j.length,f=0,b=e.length,k,d,a,g;for(k=0;k<b;k++){a=e[k];for(g=h;g--;){d=j[g];if(d.itemId==a.id){if(f!==g){l.moveHeader(g,f)}if(d.applyColumnState){d.applyColumnState(a)}++f;break}}}},getColumnsState:function(){var b=this,a=[],c;b.items.each(function(d){c=d.getColumnState&&d.getColumnState();if(c){c.id=d.itemId;a.push(c)}});return a}});function renderExperimentTitle(e,d,a,f,c,b){if(typeof a.get("expid")=="number"){return Ext.String.format('<a href="javascript:void(0)" onclick="launchExperimentDetail({1})">{0}</a>',e,a.get("expid"))}else{return Ext.String.format('<a href="javascript:void(0)" onclick="launchExperimentDetail(\'{1}\')">{0}</a>',e,a.get("expid"))}}function renderGeneCount(e,d,a,f,c,b){if(a.get("source")!="PATRIC"){return e}if(e!=0){return Ext.String.format('<a href="TranscriptomicsGene?cType=&cId=&dm=result&expId={1}&sampleId=&log_ratio=0&zscore=0">{0}</a>',e,a.get("eid"))}else{return 0}}function renderPubmedID(e,d,a,f,c,b){if(e!=undefined&&e!=""){return Ext.String.format('<a href="http://www.ncbi.nlm.nih.gov/pubmed/{0}" target="_blank">{0}</a>',e)}else{return""}}Ext.define("VBI.Workspace.view.columns.ExpressionExperiment",{defaults:{align:"center",draggable:false,resizable:false},items:[{text:"Source",itemId:"Experiment_source",dataIndex:"source",flex:1,align:"left"},{text:"Data Type",itemId:"Experiment_datatype",dataIndex:"data_type",flex:1,align:"left"},{text:"Title",itemId:"Experiment_title",dataIndex:"title",flex:4,align:"left",renderer:renderExperimentTitle},{text:"Comparisons",itemId:"Experiment_samples",dataIndex:"samples",flex:1},{text:"Genes",itemId:"Experiment_genes",dataIndex:"genes",flex:1,renderer:renderGeneCount},{text:"PubMed",itemId:"Experiment_pmid",dataIndex:"pmid",flex:1,renderer:renderPubmedID},{text:"Organism",itemId:"Experiment_organism",dataIndex:"organism",flex:3,align:"left",renderer:BasicRenderer}]});function linkToGeneList(e,d,a,f,c,b){if(a.get("source")!="PATRIC"){return e}if(e!=0){return Ext.String.format('<a href="TranscriptomicsGene?cType=&cId=&dm=result&expId={1}&sampleId={2}&log_ratio={3}&zscore={4}">{0}</a>',e,a.get("eid"),a.get("pid"),0,0)}else{return 0}}function linkToGeneListFold(e,d,a,f,c,b){if(a.get("source")!="PATRIC"){return e}if(e!=0){return Ext.String.format('<a href="TranscriptomicsGene?cType=&cId=&dm=result&expId={1}&sampleId={2}&log_ratio={3}&zscore={4}">{0}</a>',e,a.get("eid"),a.get("pid"),1,0)}else{return 0}}function linkToGeneListZScore(e,d,a,f,c,b){if(a.get("source")!="PATRIC"){return e}if(e!=0){return Ext.String.format('<a href="TranscriptomicsGene?cType=&cId=&dm=result&expId={1}&sampleId={2}&log_ratio={3}&zscore={4}">{0}</a>',e,a.get("eid"),a.get("pid"),0,2)}else{return 0}}Ext.define("VBI.Workspace.view.columns.ExpressionSample",{defaults:{align:"center",draggable:false,resizable:false},items:[{text:"Accession",itemId:"Sample_accession",dataIndex:"accession",flex:1,align:"left",hidden:true},{text:"Title",itemId:"Sample_expname",dataIndex:"expname",flex:4,align:"left",renderer:BasicRenderer},{text:"Genes",itemId:"Sample_genes",dataIndex:"genes",flex:1,renderer:linkToGeneList},{text:"Significant genes(Log Ratio)",itemId:"Sample_sig_log_ratio",dataIndex:"sig_log_ratio",flex:1,renderer:linkToGeneListFold},{text:"Significant genes(Z Score)",itemId:"Sample_sig_z_score",dataIndex:"sig_z_score",flex:1,renderer:linkToGeneListZScore},{text:"Organism",itemId:"Sample_organism",dataIndex:"organism",flex:1,align:"left",hidden:true,renderer:BasicRenderer},{text:"Strain",itemId:"Sample_strain",dataIndex:"strain",flex:1,align:"left",renderer:BasicRenderer},{text:"Gene Modification",itemId:"Sample_mutant",dataIndex:"mutant",flex:1,align:"left",renderer:BasicRenderer},{text:"Experimental Condition",itemId:"Sample_condision",dataIndex:"condition",flex:1,align:"left",renderer:BasicRenderer},{text:"Time Point",itemId:"Sample_timepoint",dataIndex:"timepoint",flex:1,align:"left",renderer:BasicRenderer}]});function renderGenomeName(e,d,a,f,c,b){d.tdAttr='data-qtip="'+e+'" data-qclass="x-tip"';return Ext.String.format('<a href="Genome?cType=genome&cId={0}">{1}</a>',a.data.gid,e)}function renderLocustag(e,d,a,f,c,b){d.tdAttr='data-qtip="'+e+'" data-qclass="x-tip"';return Ext.String.format('<a href="Feature?cType=feature&cId={0}">{1}</a>',a.data.na_feature_id,e)}function renderGenomeBrowserByFeature(f,e,b,d,h,g){var c="DNA,",a=Math.max(0,(b.data.start_max-1000)),i=parseInt(b.data.end_min)+1000;if(b.data.feature_type!=null&&b.data.feature_type=="CDS"){c+=b.data.feature_type}else{if(b.data.feature_type!=null&&b.data.feature_type.indexOf(/.*RNA/)!=-1){c+="RNA"}else{c+="Misc"}}if(b.data.annotation=="PATRIC"){c+="(PATRIC)"}else{if(b.data.annotation=="Legacy BRC"){c+="(BRC)"}else{c+="(RefSeq)"}}return Ext.String.format('<a href="GenomeBrowser?cType=genome&cId={0}&loc={1}:{2}..{3}&tracks={4}"><img src="/patric/images/icon_genome_browser.gif"  alt="Genome Browser" style="margin:-4px" /></a>',b.data.gid,b.data.accession,a,i,c)}Ext.define("VBI.Workspace.view.columns.Feature",{extend:"VBI.Workspace.view.columns.HeaderContainer",defaults:{align:"center"},items:[{text:"Genome Name",itemId:"Feature_genome_name",dataIndex:"genome_name",flex:3,align:"left",renderer:renderGenomeName},{text:"Accession",itemId:"Feature_accession",dataIndex:"accession",flex:1,hidden:true,renderer:BasicRenderer},{text:"Locus Tag",itemId:"Feature_locus_tag",dataIndex:"locus_tag",flex:2,align:"left",renderer:renderLocustag},{text:"RefSeq Locus Tag",itemId:"Feature_refseq_locus_tag",dataIndex:"refseq_locus_tag",flex:2,renderer:BasicRenderer},{text:"Gene Symbol",itemId:"Feature_gene",dataIndex:"gene",flex:1,renderer:BasicRenderer},{text:"Genome Browser",itemId:"Feature_",dataIndex:"",flex:1,hidden:true,sortable:false,renderer:renderGenomeBrowserByFeature},{text:"Annotation",itemId:"Feature_annotation",dataIndex:"annotation",flex:1,hidden:true,renderer:BasicRenderer},{text:"Feature Type",itemId:"Feature_feature_type",dataIndex:"feature_type",flex:1,hidden:true,renderer:BasicRenderer},{text:"Start",itemId:"Feature_start_max",dataIndex:"start_max",flex:1,hidden:true,align:"right",renderer:BasicRenderer},{text:"End",itemId:"Feature_end_min",dataIndex:"end_min",flex:1,hidden:true,align:"right",renderer:BasicRenderer},{text:"Length (NT)",itemId:"Feature_na_length",dataIndex:"na_length",flex:1,hidden:true,align:"right",renderer:BasicRenderer},{text:"Strand",itemId:"Feature_strand",dataIndex:"strand",flex:1,hidden:true},{text:"Protein ID",itemId:"Feature_refseq_protein_id",dataIndex:"protein_id",flex:1,hidden:true,renderer:BasicRenderer},{text:"Length (AA)",itemId:"Feature_aa_length",dataIndex:"aa_length",flex:1,hidden:true,align:"right",renderer:BasicRenderer},{text:"Anticodon",itemId:"Feature_anticodon",dataIndex:"anticodon",flex:1,hidden:true},{text:"Product Description",itemId:"Feature_product",dataIndex:"product",flex:4,align:"left",renderer:BasicRenderer},{text:"Bound Moiety",itemId:"Feature_bound_moiety",dataIndex:"bound_moiety",flex:1,hidden:true}]});function renderGenomeName(e,d,a,f,c,b){d.tdAttr='data-qtip="'+e+'" data-qclass="x-tip"';return Ext.String.format('<a href="Genome?cType=genome&cId={0}">{1}</a>',a.data.genome_info_id,e)}function renderGenomeBrowserByGenome(e,f,a,g,d,b){var c="DNA,CDS(PATRIC),RNA(PATRIC)";return Ext.String.format('<a href="GenomeBrowser?cType=genome&cId={0}&loc={2}..{3}&tracks={4}"><img src="/patric/images/icon_genome_browser.gif" alt="Genome Browser" style="margin:-4px" /></a>',a.data.genome_info_id,"",0,10000,c)}function renderCDS_Count_RAST(e,d,a,f,c,b){if(e!=0){d.tdAttr='data-qtip="'+e+'" data-qclass="x-tip"';return Ext.String.format('<a href="FeatureTable?cType=genome&amp;cId={0}&amp;featuretype=CDS&amp;annotation=PATRIC&amp;filtertype=">{1}</a>',a.data.genome_info_id,e)}else{d.tdAttr='data-qtip="0" data-qclass="x-tip"';return 0}}function renderCDS_Count_BRC(e,d,a,f,c,b){if(e!=0){d.tdAttr='data-qtip="'+e+'" data-qclass="x-tip"';return Ext.String.format('<a href="FeatureTable?cType=genome&amp;cId={0}&amp;featuretype=CDS&amp;annotation=BRC&amp;filtertype=">{1}</a>',a.data.genome_info_id,e)}else{d.tdAttr='data-qtip="0" data-qclass="x-tip"';return 0}}function renderCDS_Count_RefSeq(e,d,a,f,c,b){if(e!=0){d.tdAttr='data-qtip="'+e+'" data-qclass="x-tip"';return Ext.String.format('<a href="FeatureTable?cType=genome&amp;cId={0}&amp;featuretype=CDS&amp;annotation=RefSeq&amp;filtertype=">{1}</a>',a.data.genome_info_id,e)}else{d.tdAttr='data-qtip="0" data-qclass="x-tip"';return 0}}Ext.define("VBI.Workspace.view.columns.Genome",{extend:"VBI.Workspace.view.columns.HeaderContainer",defaults:{align:"center"},items:[{text:"Organism Name",itemId:"Genome_genome_name",dataIndex:"genome_name",flex:2,align:"left",renderer:renderGenomeName},{text:"Genome Status",itemId:"Genome_genome_status",dataIndex:"genome_status",flex:1},{text:"Genome Browser",itemId:"Genome_genome_browser",dataIndex:"genome_browser",flex:1,hidden:true,sortable:false,renderer:renderGenomeBrowserByGenome},{text:"Size",itemId:"Genome_genome_length",dataIndex:"genome_length",flex:1,hidden:true,align:"right"},{text:"Chromosome",itemId:"Genome_chromosomes",dataIndex:"chromosomes",flex:1,hidden:true},{text:"Plasmids",itemId:"Genome_plasmids",dataIndex:"plasmids",flex:1,hidden:true},{text:"Contigs",itemId:"Genome_contigs",dataIndex:"contigs",flex:1,hidden:true},{text:"Sequences",itemId:"Genome_sequences",dataIndex:"sequences",flex:1,hidden:true},{text:"PATRIC CDS",itemId:"Genome_rast_cds",dataIndex:"rast_cds",flex:1,renderer:renderCDS_Count_RAST},{text:"Legacy BRC CDS",itemId:"Genome_brc_cds",dataIndex:"brc_cds",flex:1,hidden:true,renderer:renderCDS_Count_BRC},{text:"RefSeq CDS",itemId:"Genome_refseq_cds",dataIndex:"refseq_cds",flex:1,hidden:true,renderer:renderCDS_Count_RefSeq},{text:"Isolation Country",itemId:"Genome_isolation_country",dataIndex:"isolation_country",flex:1},{text:"Host Name",itemId:"Genome_host_name",dataIndex:"host_name",flex:1},{text:"Disease",itemId:"Genome_disease",dataIndex:"disease",flex:1},{text:"Collection Date",itemId:"Genome_collection_date",dataIndex:"collection_date",flex:1},{text:"Completion Date",itemId:"Genome_completion_date",dataIndex:"completion_date",flex:1},{text:"Strain",itemId:"Genome_strain",dataIndex:"strain",flex:1,hidden:true},{text:"Serovar",itemId:"Genome_serovar",dataIndex:"serovar",flex:1,hidden:true},{text:"Biovar",itemId:"Genome_biovar",dataIndex:"biovar",flex:1,hidden:true},{text:"Pathovar",itemId:"Genome_pathovar",dataIndex:"pathovar",flex:1,hidden:true},{text:"Culture Collection",itemId:"Genome_culture_collection",dataIndex:"culture_collection",flex:1,hidden:true},{text:"Type Strain",itemId:"Genome_type_strain",dataIndex:"type_strain",flex:1,hidden:true},{text:"Project Status",itemId:"Genome_project_status",dataIndex:"project_status",flex:1,hidden:true},{text:"Availability",itemId:"Genome_availability",dataIndex:"availability",flex:1,hidden:true},{text:"Sequencing Center",itemId:"Genome_sequencing_centers",dataIndex:"sequencing_centers",flex:1,hidden:true},{text:"Publication",itemId:"Genome_publication",dataIndex:"publication",flex:1,hidden:true},{text:"NCBI Project Id",itemId:"Genome_ncbi_project",dataIndex:"ncbi_project_id",flex:1,hidden:true},{text:"RefSeq Project Id",itemId:"Genome_refseq_project",dataIndex:"refseq_project_id",flex:1,hidden:true},{text:"Genbank Accessions",itemId:"Genome_genbank_accessions",dataIndex:"genbank_accessions",flex:1,hidden:true},{text:"RefSeq Accessions",itemId:"Genome_refseq_accessions",dataIndex:"refseq_accessions",flex:1,hidden:true},{text:"Sequencing Platform",itemId:"Genome_sequencing_platform",dataIndex:"sequencing_platform",flex:1,hidden:true},{text:"Sequencing Depth",itemId:"Genome_sequencing_depth",dataIndex:"sequencing_depth",flex:1,hidden:true},{text:"Assembly Method",itemId:"Genome_assembly_method",dataIndex:"assembly_method",flex:1,hidden:true},{text:"GC Content",itemId:"Genome_gc_content",dataIndex:"gc_content",flex:1,hidden:true},{text:"Isolation Site",itemId:"Genome_isolation_site",dataIndex:"isolation_site",flex:1,hidden:true},{text:"Isolation Source",itemId:"Genome_isolation_source",dataIndex:"isolation_source",flex:1,hidden:true},{text:"Isolation Comments",itemId:"Genome_isolation_comments",dataIndex:"isolation_comments",flex:1,hidden:true},{text:"Geographic Location",itemId:"Genome_geographic_location",dataIndex:"geographic_location",flex:1,hidden:true},{text:"Latitude",itemId:"Genome_latitude",dataIndex:"latitude",flex:1,hidden:true},{text:"Longitude",itemId:"Genome_longitude",dataIndex:"longitude",flex:1,hidden:true},{text:"Altitude",itemId:"Genome_altitude",dataIndex:"altitude",flex:1,hidden:true},{text:"Depth",itemId:"Genome_depth",dataIndex:"depth",flex:1,hidden:true},{text:"Host Gender",itemId:"Genome_host_gender",dataIndex:"host_gender",flex:1,hidden:true},{text:"Host Age",itemId:"Genome_host_age",dataIndex:"host_age",flex:1,hidden:true},{text:"Host Health",itemId:"Genome_host_health",dataIndex:"host_health",flex:1,hidden:true},{text:"Body Sample Site",itemId:"Genome_body_sample",dataIndex:"body_sample_site",flex:1,hidden:true},{text:"Body Sample Subsite",itemId:"Genome_body_sample",dataIndex:"body_sample_subsite",flex:1,hidden:true},{text:"Gram Stain",itemId:"Genome_gram_stain",dataIndex:"gram_stain",flex:1,hidden:true},{text:"Cell Shape",itemId:"Genome_cell_shape",dataIndex:"cell_shape",flex:1,hidden:true},{text:"Motility",itemId:"Genome_motility",dataIndex:"motility",flex:1,hidden:true},{text:"Sporulation",itemId:"Genome_sporulation",dataIndex:"sporulation",flex:1,hidden:true},{text:"Temperature Range",itemId:"Genome_temperature_range",dataIndex:"temperature_range",flex:1,hidden:true},{text:"Optimal Temperature",itemId:"Genome_optimal_temperature",dataIndex:"optimal_temperature",flex:1,hidden:true},{text:"Salinity",itemId:"Genome_salinity",dataIndex:"salinity",flex:1,hidden:true},{text:"Oxygen Requirement",itemId:"Genome_oxygen_requirement",dataIndex:"oxygen_requirement",flex:1,hidden:true},{text:"Habitat",itemId:"Genome_habitat",dataIndex:"habitat",flex:1,hidden:true},{text:"Others",itemId:"Genome_comments",dataIndex:"comments",flex:1,hidden:true}]});Ext.define("VBI.Workspace.view.columns.HeaderContainer",{applyColumnsState:function(e){if(!e||!e.length){return}var l=this,j=l.items.items,h=j.length,f=0,b=e.length,k,d,a,g;for(k=0;k<b;k++){a=e[k];for(g=h;g--;){d=j[g];if(d.itemId==a.id){if(f!==g){l.moveHeader(g,f)}if(d.applyColumnState){d.applyColumnState(a)}++f;break}}}},getColumnsState:function(){var b=this,a=[],c;b.items.each(function(d){c=d.getColumnState&&d.getColumnState();if(c){c.id=d.itemId;a.push(c)}});return a}});Ext.define("VBI.Workspace.view.group.Browser",{extend:"Ext.view.View",alias:"widget.groupbrowser",tpl:['<tpl for=".">','<div class="thumb-wrap">','<div class="thumb">',(!Ext.isIE6?'<img src="{thumb}"  alt="{name}" title="{name}" />':"<div style=\"width:76px;height:76px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{thumb}')\"></div>"),"</div>",'<div class="title">{[Ext.String.ellipsis(values.name, 20)]} ({members})</div>','<div class="type">{type} Group</div>','<div class="updated">Updated: {[Ext.Date.format(Ext.Date.parse(values.mdate, "Y-m-d H:i:s"), "x-date-relative")]}</div>',"</div>","</tpl>"],autoScroll:true,multiSelect:true,itemSelector:"div.thumb-wrap",cls:"x-browser-view"});Ext.define("VBI.Workspace.view.group.DetailToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.detailtoolbar",items:[{text:"<font color=#fff><b>All Groups</b></font>",iconCls:"leftarrow",overCls:"",pressedCls:"",style:{"background-color":"#0a4773"},minWidth:95,itemId:"backButton",scope:this}]});Ext.define("VBI.Workspace.view.group.ExperimentInfoEditor",{extend:"Ext.form.Panel",alias:"widget.experimentinfoeditor",width:225,minWidth:225,bodyPadding:5,cls:"x-infoeditor-view",fieldDefaults:{labelAlign:"left",anchor:"100%",labelStyle:"font-weight:bold"},items:[{xtype:"displayfield",itemId:"title",name:"title",hideLabel:true,fieldStyle:{fontSize:"15px",fontWeight:"bold"},style:{marginBottom:"0px"}},{xtype:"displayfield",name:"samples",hideLabel:true,fieldStyle:{paddingTop:"0px"}},{xtype:"displayfield",itemId:"datatype",name:"datatype",renderer:function(b,a){return b+" Experiment"},fieldStyle:{paddingBottom:"5px",borderTop:"1px dashed #000000",borderBottom:"1px dashed #000000"}},{xtype:"displayfield",name:"organism",itemId:"organism",fieldLabel:"Platform Organism",labelAlign:"top"},{xtype:"displayfield",name:"pmid",itemId:"pmid",fieldLabel:"Pubmed ID",labelWidth:80,renderer:function(b,a){return Ext.String.format('<a href="http://www.ncbi.nlm.nih.gov/pubmed/{0}" target=_blank>{0}</a>',b)}},{xtype:"displayfield",name:"description",itemId:"description",fieldLabel:"Description",labelAlign:"top"},{xtype:"displayfield",name:"updated",fieldLabel:"Last modified",labelWidth:90,value:"none"},{xtype:"displayfield",name:"created",fieldLabel:"Uploaded",labelWidth:70,value:"none"},{xtype:"displayfield",name:"file",fieldLabel:"Source file",labelWidth:70,value:"none"},{xtype:"button",itemId:"editInfoBtn",text:"Edit",iconCls:"x-btn-edit",iconAlign:"right",scope:this,enableToggle:true}],loadRecord:function(a){this.record=a;var b;if(a.get("samples")>1){b="("+a.get("samples")+" comparisons)"}else{b="("+a.get("samples")+" comparison)"}this.getForm().setValues({title:a.get("title"),samples:b,datatype:a.get("data_type")||"Transcriptomics",description:a.get("desc"),organism:a.get("organism"),pmid:(a.get("pmid")!=0)?a.get("pmid"):"",updated:Ext.Date.format(Ext.Date.parse(a.get("mdate"),"Y-m-d H:i:s"),"M j, Y"),created:Ext.Date.format(Ext.Date.parse(a.get("cdate"),"Y-m-d H:i:s"),"M j, Y"),file:a.get("origFileName")});if(a.get("source")=="PATRIC"){this.getComponent("editInfoBtn").setDisabled(true)}else{this.getComponent("editInfoBtn").setDisabled(false)}},startEdit:function(){this.remove("title");this.insert(0,{xtype:"textfield",name:"title",itemId:"title",fieldLabel:"Experiment title",labelAlign:"top",allowBlank:false});this.remove("datatype");this.insert(2,{xtype:"combobox",name:"datatype",itemId:"datatype",store:{xtype:"store",fields:["name","text"],data:[{name:"Transcriptomics",text:"Transcriptomics"},{name:"Proteomics",text:"Proteomics"},{name:"Phenomics",text:"Phenomics"}]},queryMode:"local",displayField:"text",valueField:"name",editable:false});this.remove("organism");this.insert(3,{xtype:"textfield",name:"organism",itemId:"organism",fieldLabel:"Platform Organism",labelAlign:"top"});this.remove("pmid");this.insert(4,{xtype:"numberfield",name:"pmid",itemId:"pmid",fieldLabel:"Pubmed ID",labelWidth:80,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false});this.remove("description");this.insert(5,{xtype:"textareafield",name:"description",itemId:"description",fieldLabel:"Description",labelAlign:"top",allowBlank:true,grow:true,growMin:20,growMax:100});this.loadRecord(this.record);this.getComponent("editInfoBtn").setText("Save")},finishEdit:function(){var a=this.getForm().getValues();this.record.set("title",a.title);this.record.set("data_type",a.datatype);this.record.set("desc",a.description);this.record.set("organism",a.organism);this.record.set("pmid",a.pmid);console.log(a,this.record);Ext.getStore("ExpressionExperiments").sync();this.disableFields()},disableFields:function(){this.remove("title");this.insert(0,{xtype:"displayfield",itemId:"title",name:"title",hideLabel:true,fieldStyle:{fontSize:"15px",fontWeight:"bold"},style:{marginBottom:"0px"}});this.remove("datatype");this.insert(2,{xtype:"displayfield",itemId:"datatype",name:"datatype",renderer:function(b,a){return b+" Experiment"},fieldStyle:{paddingBottom:"5px",borderTop:"1px dashed #000000",borderBottom:"1px dashed #000000"}});this.remove("organism");this.insert(3,{xtype:"displayfield",name:"organism",itemId:"organism",fieldLabel:"Platform Organism",labelAlign:"top"});this.remove("pmid");this.insert(4,{xtype:"displayfield",name:"pmid",itemId:"pmid",fieldLabel:"Pubmed ID",labelWidth:80,renderer:function(b,a){return Ext.String.format('<a href="http://www.ncbi.nlm.nih.gov/pubmed/{0}" target=_blank>{0}</a>',b)}});this.remove("description");this.insert(5,{xtype:"displayfield",name:"description",itemId:"description",fieldLabel:"Description",labelAlign:"top"});this.loadRecord(this.record);this.getComponent("editInfoBtn").setText("Edit")}});Ext.define("VBI.Workspace.view.group.GroupInfoEditor",{extend:"Ext.form.Panel",alias:"widget.groupinfoeditor",width:225,minWidth:225,bodyPadding:5,cls:"x-infoeditor-view",fieldDefaults:{labelAlign:"left",anchor:"100%",labelStyle:"font-weight:bold"},items:[{xtype:"component",id:"group-viewer-thumb",tpl:['<tpl for=".">',"<div>",'<img src="{thumb}" alt="{title}" title="{title}" />','<span class="title">{title}</span>',"<div>{desc}</div>",'<div class="clear"></div>',"</div>","</tpl>"]},{xtype:"displayfield",name:"groupname",itemId:"groupname",hideLabel:true,allowBlank:false,fieldStyle:{fontSize:"13px",fontWeight:"bold",paddingBottom:"5px",borderBottom:"1px dashed #000000"}},{xtype:"displayfield",name:"description",itemId:"description",fieldLabel:"Description",labelAlign:"top"},{xtype:"displayfield",name:"tags",fieldLabel:"Tags",labelWidth:32},{xtype:"displayfield",name:"updated",fieldLabel:"Last Updated",labelWidth:85},{xtype:"displayfield",name:"created",fieldLabel:"Created",labelWidth:50},{xtype:"button",itemId:"editInfoBtn",text:"Edit",iconCls:"x-btn-edit",iconAlign:"right",scope:this,enableToggle:true}],loadRecord:function(a){this.record=a;var c,b;if(a.get("type")=="Feature"){c="Feature Group";if(a.get("members")>1){b="("+a.get("members")+" features)"}else{b="("+a.get("members")+" feature)"}}else{if(a.get("type")=="Genome"){c="Genome Group";if(a.get("members")>1){b="("+a.get("members")+" genomes)"}else{b="("+a.get("members")+" genome)"}}else{if(a.get("type")=="ExpressionExperiment"){c="Transcriptomics Experiment Group";if(a.get("members")>1){b="("+a.get("members")+" experiments)"}else{b="("+a.get("members")+" experiment)"}}else{c="Unknown Group";if(a.get("members")>1){b="("+a.get("members")+" members)"}else{b="("+a.get("members")+" member)"}}}}Ext.getCmp("group-viewer-thumb").update({thumb:a.get("thumb"),title:c,desc:b});this.getForm().setValues({groupname:a.get("name"),description:a.get("desc"),tags:a.get("tags"),updated:Ext.Date.format(Ext.Date.parse(a.get("mdate"),"Y-m-d H:i:s"),"M j, Y"),created:Ext.Date.format(Ext.Date.parse(a.get("cdate"),"Y-m-d H:i:s"),"M j, Y"),owner:a.get("owner")})},startEdit:function(){this.remove("groupname");this.insert(1,{xtype:"textfield",name:"groupname",itemId:"groupname",hideLabel:true,allowBlank:false,value:"none"});this.remove("description");this.insert(2,{xtype:"textareafield",name:"description",itemId:"description",fieldLabel:"Description",labelAlign:"top",allowBlank:true,grow:true,growMin:20,growMax:100,value:"none"});this.loadRecord(this.record);this.getComponent("editInfoBtn").setText("Save")},finishEdit:function(){var a=this.getForm().getValues();this.record.set("desc",a.description);this.record.set("name",a.groupname);Ext.getStore("Groups").sync();this.disableFields()},disableFields:function(){this.remove("groupname");this.insert(1,{xtype:"displayfield",name:"groupname",itemId:"groupname",hideLabel:true,allowBlank:false,fieldStyle:{fontSize:"13px",fontWeight:"bold",paddingBottom:"5px",borderBottom:"1px dashed #000000"},value:"none"});this.remove("description");this.insert(2,{xtype:"displayfield",name:"description",itemId:"description",fieldLabel:"Description",labelAlign:"top",value:""});this.loadRecord(this.record);this.getComponent("editInfoBtn").setText("Edit")}});Ext.define("VBI.Workspace.view.selection.CheckboxModel",{extend:"Ext.selection.CheckboxModel",getHeaderConfig:function(){var a=this,b=a.showHeaderCheckbox!==false;return{itemId:a.itemId,isCheckerHd:b,text:"&#160;",width:a.headerWidth,sortable:false,draggable:false,resizable:false,hideable:false,menuDisabled:true,dataIndex:"",cls:b?Ext.baseCSSPrefix+"column-header-checkbox ":"",renderer:Ext.Function.bind(a.renderer,a),editRenderer:a.editRenderer||a.renderEmpty,locked:a.hasLockedHeader()}}});Ext.define("VBI.Workspace.view.toolbar.ExpressionExperiment",{extend:"Ext.toolbar.Toolbar",alias:"widget.expressionexperimenttoolbar",getSelectedGroup:function(){var a=Ext.getCmp("workspace_view"),c,b=new Array();if(a.activeItem=="groupview"){c=new Array();b.push(Ext.getCmp("workspace_groupinfoeditor").record.get("tagId"))}else{c=Ext.getCmp("columnbrowser_groups").getSelectionModel().getSelection();Ext.Array.each(c,function(d){b.push(d.get("tagId"))})}return b},getSelectedID:function(c){var b;if(Ext.getCmp("workspace_view").activeItem=="groupview"){b=Ext.getCmp("workspace_detailview").child("#panel_grid").child("#experimentview").getSelectionModel().getSelection()}else{b=Ext.getCmp("workspace_listview").child("#experimentview").getSelectionModel().getSelection()}if(b.length==0){Ext.Msg.alert("Alert","No experiment was selected");return null}else{var a=new Array();Ext.Array.each(b,function(d){if(c!=undefined){a.push(d.get(c))}else{a.push(d.get("expid"))}});return a}},refreshWorkspaceViews:function(){Ext.getStore("Mappings").load({callback:function(){Ext.getStore("Groups").load({callback:function(){Ext.getStore("ColumnBrowser").refresh({callback:function(){Ext.getStore("Stations").load({callback:function(){Ext.getCmp("workspace_station").setDefault("ExpressionExperiments");updateCartInfo()}})}})}})}})},layout:{type:"hbox",align:"stretch"},items:[{title:"Workspace",xtype:"buttongroup",columns:1,items:[{xtype:"tbar_btn_remove",text:"Remove Experiment(s)",width:150,handler:function(b,f){var a=b.findParentByType("toolbar").getSelectedGroup(),d=b.findParentByType("toolbar").getSelectedID(),c=this;if(d==null){return false}if(a.length==0){Ext.Msg.show({msg:"Do you want to delete this experiment from your workspace?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(g,e){if(g=="ok"&&d.length>0){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE",params:{action_type:"groupAction",action:"removeTrack",removeFrom:"workspace",idType:"ExpressionExperiment",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}}})}else{Ext.Msg.show({msg:"Do you want to delete this genome from your selected groups? Click No if you want to delete from entire workspace",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g,e){if(g=="yes"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE",params:{action_type:"groupAction",action:"removeTrack",removeFrom:"groups",groups:a.join(","),idType:"ExpressionExperiment",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}else{if(g=="no"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE",params:{action_type:"groupAction",action:"removeTrack",removeFrom:"workspace",idType:"ExpressionExperiment",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}}}})}}},{xtype:"tbar_btn_create",text:"Add to Group",handler:function(a,d){var c=a.findParentByType("toolbar").getSelectedID(),b=this;if(c==null){return false}var f=new Ext.Button({text:"Save to Group",handler:function(g,h){saveToGroup(c.join(","),"ExpressionExperiment");b.findParentByType("toolbar").refreshWorkspaceViews()}});popup=Ext.create("VBI.Workspace.view.Toolbar.window.AddToGroup",{title:"Add Selected Experiments to Group",buttons:[f,{text:"Cancel",handler:function(){popup.hide()}}]}).show()}}]},{title:"View",xtype:"buttongroup",width:115,items:[{xtype:"tbar_btn_genelist",handler:function(a,d){var i=a.findParentByType("toolbar").getSelectedID(),c=new Array(),h=new Array(),j=Ext.getStore("ExpressionExperiments"),g=0,f=100,b;Ext.Array.each(i,function(e){item=j.getById(e);g+=item.get("samples");if(item.get("source")=="PATRIC"){c.push(item.get("eid"))}else{if(item.get("source")=="me"){h.push(item.get("expid"))}}});if(g>=f){alert("You have exceeded the limit of comparisons. Please lower than "+f);return false}b="&expId="+c.join(",")+"&sampleId=&colId="+h.join(",");if(c.length>0||h.length>0){this.fireEvent("runGeneList",b)}}}]},{title:"Download",xtype:"buttongroup",width:115,items:[{scale:"small",iconAlign:"left",width:110,text:"Table",icon:"/patric/images/toolbar_table.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_tb_txt",handler:function(){this.fireEvent("downloadGrid","txt")}},{xtype:"tbar_menu_dn_tb_xls",handler:function(){this.fireEvent("downloadGrid","xlsx")}}]}]},{title:"Upload",xtype:"buttongroup",width:155,items:[{scale:"large",text:"Transcriptomics Data",icon:"/patric/images/transcriptomics_uploader_icon_32x32.png",handler:launchTranscriptomicsUploader}]},"->","-",{xtype:"tbar_btngrp_help"}]});Ext.define("VBI.Workspace.view.toolbar.ExpressionSample",{extend:"Ext.toolbar.Toolbar",alias:"widget.expressionsampletoolbar",getSelectedID:function(){var b=Ext.getCmp("workspace_detailview").child("#panel_grid").child("#experimentdetail").getSelectionModel().getSelection();if(b.length==0){Ext.Msg.alert("Alert","No sample was selected");return null}else{var a=new Array();Ext.Array.each(b,function(c){a.push(c.get("pid"))});return a}},refreshWorkspaceViews:function(){Ext.getStore("Mappings").load({callback:function(){Ext.getStore("Groups").load({callback:function(){Ext.getStore("ColumnBrowser").refresh({callback:function(){Ext.getStore("Stations").load({callback:function(){Ext.getCmp("workspace_station").setDefault("ExpressionExperiments");updateCartInfo()}})}})}})}})},layout:{type:"hbox",align:"stretch"},items:[{xtype:"tbspacer",width:220},{title:"View",xtype:"buttongroup",width:115,items:[{xtype:"tbar_btn_genelist",handler:function(c,g){var d=c.findParentByType("toolbar").getSelectedID(),f=Ext.getCmp("workspace_experimentinfoeditor").record.get("expid"),b=Ext.getStore("ExpressionExperiments"),a=100,h="";if(d!=undefined){if(d.length>=a){alert("You have exceeded the limit of comparisons. Please lower than "+a);return false}if(b.getById(f).get("source")=="PATRIC"){h="&expId="+f+"&sampleId="+d.join(",")+"&colId="}else{if(b.getById(f).get("source")=="me"){h="&expId=&sampleId=&colId="+f+":"+d.join("+").replace(new RegExp(f,"g"),"")}}this.fireEvent("runGeneList",h)}}}]},{title:"Download",xtype:"buttongroup",width:115,items:[{scale:"small",iconAlign:"left",width:110,text:"Table",icon:"/patric/images/toolbar_table.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_tb_txt",handler:function(){this.fireEvent("downloadGrid","txt")}},{xtype:"tbar_menu_dn_tb_xls",handler:function(){this.fireEvent("downloadGrid","xlsx")}}]}]},"->","-",{xtype:"tbar_btngrp_help"}]});Ext.define("VBI.Workspace.view.toolbar.Feature",{extend:"Ext.toolbar.Toolbar",alias:"widget.featuretoolbar",getSelectedGroup:function(){var a=Ext.getCmp("workspace_view");var c;var b=new Array();if(a.activeItem=="groupview"){c=new Array();b.push(Ext.getCmp("workspace_groupinfoeditor").record.get("tagId"))}else{c=Ext.getCmp("columnbrowser_groups").getSelectionModel().getSelection();Ext.Array.each(c,function(d){b.push(d.get("tagId"))})}return b},getSelectedID:function(){var b;if(Ext.getCmp("workspace_view").activeItem=="groupview"){b=Ext.getCmp("workspace_detailview").child("#panel_grid").child("#featureview").getSelectionModel().getSelection()}else{b=Ext.getCmp("workspace_listview").child("#featureview").getSelectionModel().getSelection()}if(b.length==0){Ext.Msg.alert("Alert","No feature was selected");return null}else{var a=new Array();Ext.Array.each(b,function(c){a.push(c.get("na_feature_id"))});return a}},refreshWorkspaceViews:function(){Ext.getStore("Mappings").load({callback:function(){Ext.getStore("Groups").load({callback:function(){Ext.getStore("ColumnBrowser").refresh({callback:function(){Ext.getStore("Stations").load({callback:function(){Ext.getCmp("workspace_station").setDefault("Features");updateCartInfo()}})}})}})}})},items:[{title:"Workspace",xtype:"buttongroup",columns:1,items:[{xtype:"tbar_btn_remove",handler:function(b,f){var a=this.findParentByType("toolbar").getSelectedGroup();var d=this.findParentByType("toolbar").getSelectedID();if(d==null){return false}var c=this;if(a.length==0){Ext.Msg.show({msg:"Do you want to delete this feature from your workspace?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(g,e){if(g=="ok"&&d.length>0){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"workspace",idType:"Feature",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}}})}else{Ext.Msg.show({msg:"Do you want to delete this feature from your selected groups? Click No if you want to delete from entire workspace",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g,e){if(g=="yes"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"groups",groups:a.join(","),idType:"Feature",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}else{if(g=="no"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"workspace",idType:"Feature",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}}}})}}},{xtype:"tbar_btn_create",handler:function(a,d){var c=this.findParentByType("toolbar").getSelectedID();if(c==null){return false}var b=this;var f=new Ext.Button({text:"Save to Group",handler:function(g,h){saveToGroup(c.join(","),"Feature");b.findParentByType("toolbar").refreshWorkspaceViews()}});popup=Ext.create("VBI.Workspace.view.Toolbar.window.AddToGroup",{title:"Add Selected Features to Group",buttons:[f,{text:"Cancel",handler:function(){popup.hide()}}]}).show()}}]},"-",{title:"View",xtype:"buttongroup",columns:1,items:[{scale:"small",iconAlign:"left",text:"FASTA DNA",icon:"/patric/images/toolbar_dna.png",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","display","dna",a.join(","))}}},{scale:"small",iconAlign:"left",text:"FASTA Protein",icon:"/patric/images/toolbar_protein.png",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","display","protein",a.join(","))}}}]},{title:"Download",xtype:"buttongroup",width:115,items:[{scale:"small",iconAlign:"left",width:110,text:"Table",icon:"/patric/images/toolbar_table.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_tb_txt",handler:function(a){a.fireEvent("downloadGrid","txt")}},{xtype:"tbar_menu_dn_tb_xls",handler:function(a){a.fireEvent("downloadGrid","xlsx")}}]},{scale:"small",iconAlign:"left",text:"FASTA",width:110,icon:"/patric/images/toolbar_fasta.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_dna",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","download","dna",a.join(","))}}},{xtype:"tbar_menu_dn_protein",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","download","protein",a.join(","))}}},{xtype:"tbar_menu_dn_dnaprotein",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","download","both",a.join(","))}}}]}]},{title:"Tools",xtype:"buttongroup",columns:2,items:[{xtype:"tbar_btn_pathway",width:120,handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{processFigfamSelectedItems("","pathway_enrichment","","","",a.join(","))}}},{xtype:"tbar_btn_msa",width:140,handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("runMSAFeature",a.join(","))}}},{xtype:"tbar_btn_mapidsto",width:120,menu:{defaults:{height:16,style:"margin-left: 15px; margin-bottom: 0px; margin-right: 0px; margin-top: 5px;",plain:true},items:[{text:"<b>PATRIC Identifiers</b>",style:"margin-left: 5px; margin-bottom: 0px; margin-right: 0px; margin-top: 5px;"},{text:"PATRIC Locus Tag",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PATRIC Locus Tag",a.join(","))}}},{text:"PATRIC ID",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PATRIC ID",a.join(","))}}},{text:"PSEED ID",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PSEED ID",a.join(","))}}},{text:"<b>REFSEQ Identifiers</b>",style:"margin-left: 5px; margin-bottom: 0px; margin-right: 0px; margin-top: 5px;"},{text:"RefSeq Locus Tag",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","RefSeq Locus Tag",a.join(","))}}},{text:"RefSeq",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","RefSeq",a.join(","))}}},{text:"Gene ID",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","Gene ID",a.join(","))}}},{text:"GI",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","GI",a.join(","))}}},{text:"<b>Other Identifiers</b>",style:"margin-left: 5px; margin-bottom: 0px; margin-right: 0px; margin-top: 5px;"},{text:"Allergome",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","Allergome",a.join(","))}}},{text:"BioCyc",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","BioCyc",a.join(","))}}},{text:"DIP",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","DIP",a.join(","))}}},{text:"DisProt",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","DisProt",a.join(","))}}},{text:"DrugBank",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","DrugBank",a.join(","))}}},{text:"ECO2DBASE",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","ECO2DBASE",a.join(","))}}},{text:"EMBL",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EMBL",a.join(","))}}},{text:"EMBL-CDS",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EMBL-CDS",a.join(","))}}},{text:"EchoBASE",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EchoBASE",a.join(","))}}},{text:"EcoGene",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EcoGene",a.join(","))}}},{text:"EnsemblGenome",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EnsemblGenome",a.join(","))}}},{text:"EnsemblGenome_PRO",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EnsemblGenome_PRO",a.join(","))}}},{text:"EnsemblGenome_TRS",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EnsemblGenome_TRS",a.join(","))}}},{text:"More ...",itemCls:"x-menu-item-cstm",menu:[{text:"GeneTree",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","GeneTree",a.join(","))}}},{text:"GenoList",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","GenoList",a.join(","))}}},{text:"GenomeReviews",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","GenomeReviews",a.join(","))}}},{text:"HOGENOM",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","HOGENOM",a.join(","))}}},{text:"HSSP",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","HSSP",a.join(","))}}},{text:"KEGG",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","KEGG",a.join(","))}}},{text:"LegioList",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","LegioList",a.join(","))}}},{text:"Leproma",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","Leproma",a.join(","))}}},{text:"MEROPS",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","MEROPS",a.join(","))}}},{text:"MINT",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","MINT",a.join(","))}}},{text:"NMPDR",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","NMPDR",a.join(","))}}},{text:"OMA",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","OMA",a.join(","))}}},{text:"OrthoDB",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","OrthoDB",a.join(","))}}},{text:"PDB",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PDB",a.join(","))}}},{text:"PeroxiBase",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PeroxiBase",a.join(","))}}},{text:"PptaseDB",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PptaseDB",a.join(","))}}},{text:"ProtClustDB",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","ProtClustDB",a.join(","))}}},{text:"PseudoCAP",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PseudoCAP",a.join(","))}}},{text:"REBASE",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","REBASE",a.join(","))}}},{text:"Reactome",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","Reactome",a.join(","))}}},{text:"RefSeq_NT",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","RefSeq_NT",a.join(","))}}},{text:"TCDB",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","TCDB",a.join(","))}}},{text:"TIGR",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","TIGR",a.join(","))}}},{text:"TubercuList",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","TubercuList",a.join(","))}}},{text:"UniParc",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniParc",a.join(","))}}},{text:"UniProtKB-ID",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniProtKB-ID",a.join(","))}}},{text:"UniRef100",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniRef100",a.join(","))}}},{text:"UniRef50",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniRef50",a.join(","))}}},{text:"UniRef90",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniRef90",a.join(","))}}},{text:"World-2DPAGE",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","World-2DPAGE",a.join(","))}}},{text:"eggNOG",handler:function(b){var a=b.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","eggNOG",a.join(","))}}}]}]}}]},{title:"Columns",xtype:"buttongroup",items:[{xtype:"tbar_btn_showhide",menu:[],handler:function(c){if(c.menu.items.length==0){var b=c.findParentByType("gridpanel");if(b!=null){c.menu=b.headerCt.getMenu().child("#columnItem").menu}else{var a=c.findParentByType("detailview");if(a!=null){b=a.child("#panel_grid").child("#featureview");c.menu=b.headerCt.getMenu().child("#columnItem").menu}}c.showMenu()}}}]},"->","-",{xtype:"tbar_btngrp_help"}],layout:{type:"hbox",align:"stretch"}});Ext.define("VBI.Workspace.view.toolbar.Genome",{extend:"Ext.toolbar.Toolbar",alias:"widget.genometoolbar",getSelectedGroup:function(){var a=Ext.getCmp("workspace_view");var c;var b=new Array();if(a.activeItem=="groupview"){c=new Array();b.push(Ext.getCmp("workspace_groupinfoeditor").record.get("tagId"))}else{c=Ext.getCmp("columnbrowser_groups").getSelectionModel().getSelection();Ext.Array.each(c,function(d){b.push(d.get("tagId"))})}return b},getSelectedID:function(){var b;if(Ext.getCmp("workspace_view").activeItem=="groupview"){b=Ext.getCmp("workspace_detailview").child("#panel_grid").child("#genomeview").getSelectionModel().getSelection()}else{b=Ext.getCmp("workspace_listview").child("#genomeview").getSelectionModel().getSelection()}if(b.length==0){Ext.Msg.alert("Alert","No genome was selected");return null}else{var a=new Array();Ext.Array.each(b,function(c){a.push(c.get("genome_info_id"))});return a}},refreshWorkspaceViews:function(){Ext.getStore("Mappings").load({callback:function(){Ext.getStore("Groups").load({callback:function(){Ext.getStore("ColumnBrowser").refresh({callback:function(){Ext.getStore("Stations").load({callback:function(){Ext.getCmp("workspace_station").setDefault("Genomes");updateCartInfo()}})}})}})}})},layout:{type:"hbox",align:"stretch"},items:[{title:"Workspace",xtype:"buttongroup",columns:1,items:[{xtype:"tbar_btn_remove",handler:function(b,f){var a=b.findParentByType("genometoolbar").getSelectedGroup(),d=b.findParentByType("genometoolbar").getSelectedID(),c=this;if(d==null){return false}if(a.length==0){Ext.Msg.show({msg:"Do you want to delete this genome from your workspace?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(g,e){if(g=="ok"&&d.length>0){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"workspace",idType:"Genome",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}}})}else{Ext.Msg.show({msg:"Do you want to delete this genome from your selected groups? Click No if you want to delete from entire workspace",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g,e){if(g=="yes"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"groups",groups:a.join(","),idType:"Genome",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}else{if(g=="no"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"workspace",idType:"Genome",idList:d.join(",")},success:function(h){c.findParentByType("toolbar").refreshWorkspaceViews()}})}}}})}}},{xtype:"tbar_btn_create",handler:function(a,d){var c=a.findParentByType("genometoolbar").getSelectedID();if(c==null){return false}var b=this;var f=new Ext.Button({text:"Save to Group",handler:function(g,h){saveToGroup(c.join(","),"Genome");b.findParentByType("toolbar").refreshWorkspaceViews()}});popup=Ext.create("VBI.Workspace.view.Toolbar.window.AddToGroup",{title:"Add Selected Genomes to Group",buttons:[f,{text:"Cancel",handler:function(){popup.hide()}}]}).show()}}]},"-",{title:"Download",xtype:"buttongroup",width:115,items:[{scale:"small",iconAlign:"left",width:110,text:"Table",icon:"/patric/images/toolbar_table.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_tb_txt",handler:function(){this.fireEvent("downloadGrid","txt")}},{xtype:"tbar_menu_dn_tb_xls",handler:function(){this.fireEvent("downloadGrid","xlsx")}}]}]},{title:"Columns",xtype:"buttongroup",items:[{xtype:"tbar_btn_showhide",menu:[],handler:function(c){if(c.menu.items.length==0){var b=c.findParentByType("gridpanel");if(b!=null){c.menu=b.headerCt.getMenu().child("#columnItem").menu}else{var a=c.findParentByType("detailview");if(a!=null){b=a.child("#panel_grid").child("#genomeview");c.menu=b.headerCt.getMenu().child("#columnItem").menu}}c.showMenu()}}}]},"->","-",{xtype:"tbar_btngrp_help"}]});Ext.define("VBI.Workspace.view.toolbar.Global",{extend:"Ext.toolbar.Toolbar",alias:"widget.globaltoolbar",switchViewButtons:function(a){if(a==null){a=Ext.getCmp("workspace_view").activeItem}if(a=="listview"){this.child("#btnItemView").toggle(true,true);this.child("#btnGroupView").toggle(false,true)}else{this.child("#btnItemView").toggle(false,true);this.child("#btnGroupView").toggle(true,true)}},items:[{xtype:"tbtext",text:"<b>Workspace</b>"},"->",{xtype:"button",itemId:"btnItemView",text:"Item View",icon:"/patric/images/workspace_item_view_icon.png",enableToggle:true,handler:function(a,b){a.fireEvent("switchToListView");a.ownerCt.switchViewButtons("listview")}},"-",{xtype:"button",itemId:"btnGroupView",text:"Group View",icon:"/patric/images/workspace_group_view_icon.png",enableToggle:true,handler:function(a,b){a.fireEvent("switchToGroupView");a.ownerCt.switchViewButtons("groupview")}}]});Ext.define("VBI.Workspace.view.toolbar.Group",{extend:"Ext.toolbar.Toolbar",alias:"widget.grouptoolbar",border:0,layout:{type:"hbox",align:"stretch"},getSelectedID:function(){var b=Ext.getCmp("workspace_groupbrowser").getSelectionModel().getSelection();if(b.length==0){Ext.Msg.alert("Alert","no group selected");return null}else{var a=new Array();Ext.Array.each(b,function(c){a.push(c.get("tagId"))});return a}},getSelectedGroupType:function(){var a=Ext.getCmp("workspace_groupbrowser").getSelectionModel().getSelection();if(a.length>0){return a[0].get("type")}},refreshWorkspaceViews:function(){Ext.getStore("ColumnBrowser").refresh({callback:function(){Ext.getStore("Groups").load({callback:function(){Ext.getStore("Stations").load();updateCartInfo()}})}})},items:[{title:"Workspace",xtype:"buttongroup",columns:1,items:[{xtype:"tbar_btn_remove",handler:function(b,c){var a=b.findParentByType("grouptoolbar").getSelectedID();if(a==null){return false}Ext.Msg.show({msg:"Do you want to delete this group from your workspace?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(e,d){if(e=="ok"&&a.length>0){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE",params:{action_type:"groupAction",action:"removeGroup",idList:a.join(",")},success:function(f){b.findParentByType("toolbar").refreshWorkspaceViews()}})}}})}}]},"-",{title:"Tools",xtype:"buttongroup",items:[{scale:"large",iconAlign:"left",text:"Group Explorer",icon:"/patric/images/toolbar_gse.png",handler:function(c,d){var b=c.findParentByType("grouptoolbar").getSelectedID();if(b==null){return false}var a=c.findParentByType("grouptoolbar").getSelectedGroupType();c.fireEvent("runGroupExplorer",b.join(","),a)}}]},{title:"Sort",xtype:"buttongroup",columns:3,items:[{text:"Name Ascending",icon:"/patric/images/hmenu-asc.gif",handler:function(){Ext.getStore("Groups").sort("name","ASC")}},{text:"Oldest First",icon:"/patric/images/calendar_icon.png",handler:function(){Ext.getStore("Groups").sort("mdate","ASC")}},{text:"Smallest First",icon:"/patric/images/sort_count_asc.png",handler:function(){Ext.getStore("Groups").sort("members","ASC")}},{text:"Name Descending",icon:"/patric/images/hmenu-desc.gif",handler:function(){Ext.getStore("Groups").sort("name","DESC")}},{text:"Newest First",icon:"/patric/images/calendar_icon.png",handler:function(){Ext.getStore("Groups").sort("mdate","DESC")}},{text:"Largest First",icon:"/patric/images/sort_count_des.png",handler:function(){Ext.getStore("Groups").sort("members","DESC")}}]},"->","-",{xtype:"tbar_btngrp_help"}]});Ext.define("VBI.Workspace.view.toolbar.Paging",{extend:"Ext.toolbar.Paging",alias:"widget.patricpagingtoolbar",beforePageSizeText:"Show",afterPageSizeText:"per page",displayMsg:"Displaying record {0} - {1} of {2}",displayInfo:true,maxPageSize:5000,maskOnDisable:true,getPagingItems:function(){var a=this;return[{itemId:"first",tooltip:a.firstText,overflowText:a.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",disabled:true,handler:a.moveFirst,scope:a},{itemId:"prev",tooltip:a.prevText,overflowText:a.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:true,handler:a.movePrevious,scope:a},"-",a.beforePageText,{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,hideTrigger:true,enableKeyEvents:true,keyNavEnabled:false,selectOnFocus:true,submitValue:false,width:a.inputItemWidth,margins:"-1 2 3 2",listeners:{scope:a,keydown:a.onPagingKeyDown,blur:a.onPagingBlur}},{xtype:"tbtext",itemId:"afterTextItem",text:Ext.String.format(a.afterPageText,1)},"-",{itemId:"next",tooltip:a.nextText,overflowText:a.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:true,handler:a.moveNext,scope:a},{itemId:"last",tooltip:a.lastText,overflowText:a.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",disabled:true,handler:a.moveLast,scope:a},"->","-",a.beforePageSizeText,{xtype:"numberfield",itemId:"pagesize",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,maxValue:64000,hideTrigger:true,enableKeyEvents:true,selectOnFocus:true,submitValue:false,width:50,margins:"-1 2 3 2",value:a.pageSize,stateful:true,stateId:"pagesize",stateEvents:["savePageSize"],applyState:function(b){if(b!=undefined&&b.value!=undefined){if(a.maxPageSize<b.value){this.setValue(a.maxPageSize)}else{a.store.pageSize=b.value;this.setValue(b.value)}}},initComponent:function(){var b=this;if(b.allowOnlyWhitespace===false){b.allowBlank=false}b.callParent();b.addEvents("autosize","keydown","keyup","keypress","change");b.setGrowSizePolicy();if(Ext.state.Manager.get("pagesize")==undefined||Ext.state.Manager.get("pagesize").value==undefined){b.setValue(20)}},listeners:{scope:a,specialKey:function(f,d){if(d.getKey()==d.ENTER){var c=f.getValue(),b=c===null;if(b==false){a.updateStore()}}}}},a.afterPageSizeText,{itemId:"refresh",text:"Apply",style:{"border-color":"#81a4d0","background-color":"#dbeeff","background-image":"-webkit-linear-gradient(top,#dbeeff,#d0e7ff 48%,#bbd2f0 52%,#bed6f5)"},handler:function(){a.updateStore()},scope:a},"-",{itemId:"saveState",text:"Apply to ALL tables",style:{"border-color":"#81a4d0","background-color":"#dbeeff","background-image":"-webkit-linear-gradient(top,#dbeeff,#d0e7ff 48%,#bbd2f0 52%,#bed6f5)"},handler:function(){if(a.updateStore()!=false){a.child("#pagesize").fireEvent("savePageSize")}},scope:a},"-"]},showMessageTip:function(d,c){var a=this,b=Ext.create("Ext.tip.QuickTip",{target:a.child("#pagesize").el,closable:true,autoHide:false,anchor:"bottom",bodyPadding:10,title:d,html:c}).show()},updateStore:function(){var c=this,a=c.getStore(),b=c.child("#pagesize").getValue();if(b>c.maxPageSize){this.showMessageTip("Warning","Maximum number of visible rows must be smaller than "+c.maxPageSize+".");return false}else{if(b!=a.pageSize){a.currentPage=1;a.pageSize=b;a.load()}}},initComponent:function(){var a=this;if(a.store!=null&&typeof a.store=="string"){a.store=Ext.getStore(a.store)}if(a.store!=null&&a.store.pageSize!=null){if(typeof a.store.pageSize=="string"){a.pageSize=parseInt(a.store.pageSize)}else{if(typeof a.store.pageSize=="number"){a.pageSize=a.store.pageSize}}}this.callParent()}});Ext.define("VBI.Workspace.view.ColumnBrowser",{extend:"Ext.panel.Panel",alias:"widget.columnbrowser",border:false,layout:{type:"hbox",align:"stretch"},items:[{xtype:"grid",id:"columnbrowser_groups",flex:1,border:true,store:"ColumnBrowser.Groups",columns:[{header:"Groups",dataIndex:"name",flex:1}],multiSelect:true,dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{text:"reset",handler:function(a,b){a.fireEvent("columnbrowserfilter_reset","groups")}}]}],listeners:{selectionchange:{fn:function(b,c,a){if(c.length>0){this.fireEvent("columnbrowserfilter","groups",c)}}}}},{xtype:"grid",id:"columnbrowser_tags",flex:1,border:true,store:"ColumnBrowser.Tags",columns:[{header:"Tags",dataIndex:"name",flex:1}],multiSelect:true,dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{text:"reset",handler:function(){this.fireEvent("columnbrowserfilter_reset","tags")}}]}],listeners:{selectionchange:{fn:function(b,c,a){if(c.length>0){this.fireEvent("columnbrowserfilter","tags",c)}}}}}]});Ext.define("VBI.Workspace.view.DetailView",{extend:"Ext.panel.Panel",alias:"widget.detailview",requires:["VBI.Workspace.view.group.GroupInfoEditor","VBI.Workspace.view.group.ExperimentInfoEditor","VBI.Workspace.view.toolbar.Group","VBI.Workspace.view.toolbar.ExpressionSample","VBI.Workspace.view.columns.Genome","VBI.Workspace.view.columns.Feature","VBI.Workspace.view.selection.CheckboxModel"],border:false,layout:"border",items:[{itemId:"panel_info",region:"west",xtype:"panel",layout:"card",border:false,activeItem:"groupinfo",items:[{itemId:"groupinfo",xtype:"groupinfoeditor",id:"workspace_groupinfoeditor"},{itemId:"experimentinfo",xtype:"experimentinfoeditor",id:"workspace_experimentinfoeditor"}]},{itemId:"panel_toolbar",region:"north",xtype:"panel",layout:"card",border:false,activeItem:"group",items:[{itemId:"group",xtype:"grouptoolbar"},{itemId:"feature",xtype:"featuretoolbar"},{itemId:"genome",xtype:"genometoolbar"},{itemId:"experiment",xtype:"expressionexperimenttoolbar",id:"expressionexperimenttoolbar"},{itemId:"sample",xtype:"expressionsampletoolbar"}]},{itemId:"panel_grid",region:"center",xtype:"panel",layout:"card",border:false,activeItem:"genomeview",items:[{itemId:"featureview",xtype:"gridpanel",store:"Features",border:false,columns:Ext.create("VBI.Workspace.view.columns.Feature"),stateful:true,stateId:"featurelist",stateEvents:["hide","show","columnmove","columnresize"],dockedItems:[{xtype:"patricpagingtoolbar",store:"Features",dock:"bottom",displayInfo:true}],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})},{itemId:"genomeview",xtype:"gridpanel",store:"Genomes",border:false,columns:Ext.create("VBI.Workspace.view.columns.Genome"),stateful:true,stateId:"genomelist",stateEvents:["hide","show","columnmove","columnresize"],dockedItems:[{xtype:"patricpagingtoolbar",store:"Genomes",dock:"bottom",displayInfo:true}],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})},{itemId:"experimentview",xtype:"gridpanel",store:"ExpressionExperiments",border:false,columns:Ext.create("VBI.Workspace.view.columns.ExpressionExperiment"),stateful:true,stateId:"experimentlist",stateEvents:["hide","show","columnmove","columnresize"],dockedItems:[{xtype:"patricpagingtoolbar",store:"ExpressionExperiments",dock:"bottom",displayInfo:true}],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})},{itemId:"experimentdetail",xtype:"gridpanel",store:"ExpressionSamples",border:false,columns:Ext.create("VBI.Workspace.view.columns.ExpressionSample"),stateful:true,stateId:"comparisonlist",stateEvents:["hide","show","columnmove","columnresize"],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})}]}]});Ext.define("VBI.Workspace.view.GroupView",{extend:"Ext.panel.Panel",alias:"widget.groupview",requires:["VBI.Workspace.view.toolbar.Group","VBI.Workspace.view.group.Browser"],border:true,dockedItems:[{xtype:"grouptoolbar"}],autoScroll:true,items:[{xtype:"groupbrowser",id:"workspace_groupbrowser",store:"Groups"}]});Ext.define("VBI.Workspace.view.ListView",{extend:"Ext.panel.Panel",alias:"widget.listview",requires:["VBI.Workspace.view.ColumnBrowser","VBI.Workspace.view.toolbar.Feature","VBI.Workspace.view.columns.Feature","VBI.Workspace.view.toolbar.Genome","VBI.Workspace.view.columns.Genome","VBI.Workspace.view.toolbar.ExpressionExperiment","VBI.Workspace.view.columns.ExpressionExperiment","VBI.Workspace.view.selection.CheckboxModel"],border:false,layout:"border",items:[{xtype:"columnbrowser",title:"Column Browser",width:200,region:"west",collapsible:true,resizable:true},{xtype:"panel",region:"center",layout:"card",activeItem:"featureview",id:"workspace_listview",flex:1,border:false,items:[{itemId:"featureview",xtype:"gridpanel",store:"Features",border:false,columns:Ext.create("VBI.Workspace.view.columns.Feature"),stateful:true,stateId:"featurelist",stateEvents:["hide","show","columnmove","columnresize"],dockedItems:[{xtype:"featuretoolbar",dock:"top"},{xtype:"patricpagingtoolbar",store:"Features",dock:"bottom"}],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})},{itemId:"genomeview",xtype:"gridpanel",store:"Genomes",border:false,columns:Ext.create("VBI.Workspace.view.columns.Genome"),stateful:true,stateId:"genomelist",stateEvents:["hide","show","columnmove","columnresize"],dockedItems:[{xtype:"genometoolbar",dock:"top"},{xtype:"patricpagingtoolbar",store:"Genomes",dock:"bottom"}],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})},{itemId:"experimentview",xtype:"gridpanel",store:"ExpressionExperiments",border:false,columns:Ext.create("VBI.Workspace.view.columns.ExpressionExperiment"),stateful:true,stateId:"experimentlist",stateEvents:["hide","show","columnmove","columnresize"],dockedItems:[{xtype:"expressionexperimenttoolbar",dock:"top"},{xtype:"patricpagingtoolbar",store:"ExpressionExperiments",dock:"bottom"}],selModel:Ext.create("VBI.Workspace.view.selection.CheckboxModel",{itemId:"checkBOX"})}]}]});Ext.define("VBI.Workspace.view.StationsList",{extend:"Ext.tree.Panel",alias:"widget.stationslist",store:"Stations",rootVisible:false,hideHeaders:true,useArrows:true,columns:[{xtype:"treecolumn",dataIndex:"name",flex:1}],setDefault:function(a){if(a=="Features"){this.getView().select(2);var b=this.getStore().getNodeById(2);this.fireEvent("itemclick",this.getView(),b)}else{if(a=="Genomes"){this.getView().select(1);var b=this.getStore().getNodeById(3);this.fireEvent("itemclick",this.getView(),b)}else{if(a=="ExpressionExperiments"){this.getView().select(3);var b=this.getStore().getNodeById(4);this.fireEvent("itemclick",this.getView(),b)}}}}});Ext.define("VBI.Workspace.view.Toolbar.button.Remove",{extend:"Ext.Button",alias:"widget.tbar_btn_remove",scale:"small",iconAlign:"left",text:"Remove",width:110,icon:"/patric/images/toolbar_workspace_remove.png"});Ext.define("VBI.Workspace.view.Toolbar.button.Create",{extend:"Ext.Button",alias:"widget.tbar_btn_create",scale:"small",iconAlign:"left",text:"Create",width:110,icon:"/patric/images/toolbar_workspace_add.png"});Ext.define("VBI.Workspace.view.Toolbar.button.Pathway",{extend:"Ext.Button",alias:"widget.tbar_btn_pathway",scale:"small",iconAlign:"left",text:"Pathway Summary",icon:"/patric/images/16x16-toolbar-icon-pathway.png"});Ext.define("VBI.Workspace.view.Toolbar.button.MSA",{extend:"Ext.Button",alias:"widget.tbar_btn_msa",scale:"small",iconAlign:"left",text:"Multiple Seq Alignment",icon:"/patric/images/16x16-toolbar-icon-msa.png"});Ext.define("VBI.Workspace.view.Toolbar.button.MapIDsTo",{extend:"Ext.Button",alias:"widget.tbar_btn_mapidsto",scale:"small",iconAlign:"left",text:"MAP IDs to...",icon:"/patric/images/16x16-toolbar-icon-idmapping.png"});Ext.define("VBI.Workspace.view.Toolbar.button.GeneList",{extend:"Ext.Button",alias:"widget.tbar_btn_genelist",scale:"small",iconAlign:"left",text:"Gene List",width:110,icon:"/patric/images/toolbar_icon_genelist.png"});Ext.define("VBI.Workspace.view.Toolbar.button.ShowHide",{extend:"Ext.Button",alias:"widget.tbar_btn_showhide",scale:"large",iconAlign:"left",icon:"/patric/images/toolbar_hideshow.png",text:"Show/Hide"});Ext.define("VBI.Workspace.view.Toolbar.button.ResetColumnState",{extend:"Ext.Button",alias:"widget.tbar_btn_resetcolumnstate",scale:"large",iconAlign:"left",text:"Reset<br/>Configs"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_Table_Txt",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_tb_txt",scale:"small",iconAlign:"left",text:"Text File (.txt)",icon:"/patric/images/toolbar_text.png"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_Table_Xls",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_tb_xls",scale:"small",iconAlign:"left",text:"Excel file (.xlsx)",icon:"/patric/images/toolbar_excel.png"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_dna",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_dna",scale:"small",iconAlign:"left",text:"DNA",icon:"/patric/images/toolbar_dna.png",});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_protein",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_protein",scale:"small",iconAlign:"left",text:"Protein",icon:"/patric/images/toolbar_protein.png"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_dnaprotein",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_dnaprotein",scale:"small",iconAlign:"left",text:"DNA/Protein",icon:"/patric/images/toolbar_dna_protein.png"});Ext.define("VBI.Workspace.view.Toolbar.buttongroup.Help",{extend:"Ext.container.ButtonGroup",alias:"widget.tbar_btngrp_help",title:"Help",items:[{scale:"large",text:"FAQs",icon:"/patric/images/toolbar_faq.png",handler:function(){window.open("http://enews.patricbrc.org/faqs/","_new","menubar=1,resizable=1,scrollbars=1, fullscreen=1, toolbar=1,titlebar=1,status=1")}}]});Ext.define("VBI.Workspace.view.Toolbar.window.AddToGroup",{extend:"Ext.Window",alias:"widget.tbar_window_addtogroup",layout:"fit",width:350,height:300,closeAction:"hide",modal:true,items:[{xtype:"addtoworkspace",id:"ATGform"}]});Ext.define("VBI.Workspace.view.Viewport",{extend:"Ext.container.Viewport",requires:["VBI.Workspace.view.Toolbar","VBI.Workspace.view.toolbar.Global","VBI.Workspace.view.toolbar.Paging","VBI.Workspace.view.StationsList","VBI.Workspace.view.ListView","VBI.Workspace.view.GroupView","VBI.Workspace.view.DetailView"],layout:"border",items:[{region:"center",xtype:"panel",dockedItems:[{dock:"top",xtype:"globaltoolbar",id:"workspace_globaltoolbar",height:30}],layout:"border",items:[{region:"west",xtype:"panel",border:false,items:[{xtype:"stationslist",id:"workspace_station",border:false,width:150,height:250},{xtype:"panel",layout:"vbox",border:false,cls:"no-underline-links",items:[{xtype:"component",autoEl:{tag:"img",onclick:"launchTranscriptomicsUploader()",style:"cursor: pointer",src:"/patric/images/transcriptomics_uploader_ad.png"},margin:"0 25px",height:99},{xtype:"displayfield",width:130,margin:"0 0 0 10px",value:'<a href="javascript:void(0)" onclick="launchTranscriptomicsUploader()">Upload your transcriptomics data</a> to analyze using PATRIC tools and to compare with other published datasets.'},{xtype:"component",overCls:"no-underline-links",autoEl:{tag:"a",href:"http://enews.patricbrc.org/faqs/transcriptomics-faqs/upload-transcriptomics-data-to-workspace-faqs/",html:"Learn more",target:"_blank",cls:"double-arrow-link"},padding:"0 0 0 10px"}]}]},{region:"center",xtype:"panel",id:"workspace_view",layout:"card",stateful:true,activeItem:"listview",stateEvents:["updateview"],getState:function(){return{activeItem:this.activeItem}},applyState:function(a){if(a!=undefined&&this.activeItem!=a.activeItem){this.activeItem=a.activeItem;this.fireEvent("updateview")}},border:false,items:[{itemId:"listview",xtype:"listview"},{itemId:"groupview",xtype:"groupview"},{itemId:"detailview",xtype:"detailview",id:"workspace_detailview"}]}]}],onRender:function(){var a=this;a.callParent(arguments);a.width=Ext.Element.getViewportWidth()-15;a.height=Math.max(580,Ext.Element.getViewportHeight()-320)},initComponent:function(){var c=this,a=document.body.parentNode,b;c.callParent(arguments);c.el=b=Ext.get("wksp")},fireResize:function(b,a){if(b!=this.width||a!=this.height){this.setSize(b-15,Math.max(580,a-320))}}});Ext.define("VBI.Workspace.controller.ColumnBrowser",{extend:"Ext.app.Controller",init:function(){this.control({"columnbrowser > grid":{columnbrowserfilter:this.onColumnBrowserFilter},"columnbrowser > grid > toolbar > button":{columnbrowserfilter_reset:this.onColumnBrowserReset}})},onColumnBrowserReset:function(b){var c=Ext.getStore("Mappings");var a=Ext.getStore("Features");if(b=="groups"){c.setTrackFilter("Group",null);c.setTrackFilter("String",null);a.filterByTracks(c.getFilteredTracks());this.resetColumnBrowserGroupsUI();this.resetColumnBrowserTagsUI()}else{if(b=="tags"){c.setTrackFilter("String",null);a.filterByTracks(c.getFilteredTracks());this.resetColumnBrowserTagsUI()}}},onColumnBrowserFilter:function(i,g){var a=Ext.getStore("Mappings");var f=Ext.getStore("ColumnBrowser.Tags");var k=Ext.getStore("Features");var j=Ext.getStore("Genomes");var h=Ext.getStore("ExpressionExperiments");var b=Ext.getStore("Groups");if(i=="groups"){var e=new Array();Ext.each(g,function(l){e.push(l.get("tagId"))});a.setTrackFilter("Group",e);a.setTrackFilter("String",null);this.resetColumnBrowserTagsUI();var d=a.getFilteredTracks();k.filterByTracks(d);j.filterByTracks(d);h.filterByTracks(d);var c=a.getTagsByTrack(d);f.filterByTag(c);b.filterByTag(e)}else{if(i=="tags"){var c=new Array();Ext.each(g,function(l){c.push(l.get("tagId"))});a.setTrackFilter("String",c);var d=a.getFilteredTracks();k.filterByTracks(d);j.filterByTracks(d)}}},resetColumnBrowserGroupsUI:function(){Ext.getCmp("columnbrowser_groups").getSelectionModel().deselectAll()},resetColumnBrowserTagsUI:function(){Ext.getCmp("columnbrowser_tags").getSelectionModel().deselectAll()}});Ext.define("VBI.Workspace.controller.Experiment",{extend:"Ext.app.Controller",init:function(){this.control({"expressionexperimenttoolbar button":{runGeneList:this.runGeneList},"expressionexperimenttoolbar menuitem":{downloadGrid:this.downloadExperiments},"expressionsampletoolbar button":{runGeneList:this.runGeneList},"expressionsampletoolbar menuitem":{downloadGrid:this.downloadSamples},"experimentinfoeditor > button":{click:this.toggleEditorFields}})},runGeneList:function(a){document.location.href="/portal/portal/patric/TranscriptomicsGene?cType=&cId=&dm=result&log_ratio=&zscore=&pk="+a},toggleEditorFields:function(b,c,a){var d=b.findParentByType("experimentinfoeditor");b.pressed?d.startEdit():d.finishEdit()},downloadExperiments:function(d){var b=Ext.getStore("ExpressionExperiments"),a=new Array(),c=new Array();Ext.Array.each(b.getRange(),function(f){if(f.get("source")=="PATRIC"){a.push({trackType:"ExpressionExperiment",internalId:f.internalId})}else{if(f.get("source")=="me"){c.push(f.internalId)}}});var e={PATRICExperiments:a,USERExperiments:c};Ext.getDom("fTableForm").action="/patric-searches-and-tools/jsp/grid_download_handler.jsp";Ext.getDom("fTableForm").target="";Ext.getDom("tablesource").value="Workspace";Ext.getDom("fileformat").value=d;Ext.getDom("idType").value="ExpressionExperiment";Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getToken",success:function(f){e.token=f.responseText;Ext.getDom("fids").value=Ext.JSON.encode(e);Ext.getDom("fTableForm").submit()}})},downloadSamples:function(b){var a=Ext.getStore("ExpressionSamples"),d=Ext.getCmp("workspace_experimentinfoeditor").record,c={source:d.get("source"),eid:d.get("eid"),expId:d.get("expid")};Ext.getDom("fTableForm").action="/patric-searches-and-tools/jsp/grid_download_handler.jsp";Ext.getDom("fTableForm").target="";Ext.getDom("tablesource").value="Workspace";Ext.getDom("fileformat").value=b;Ext.getDom("idType").value="ExpressionSample";Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getToken",success:function(e){c.token=e.responseText;Ext.getDom("fids").value=Ext.JSON.encode(c);Ext.getDom("fTableForm").submit()}})}});Ext.define("VBI.Workspace.controller.Feature",{extend:"Ext.app.Controller",init:function(){this.control({"featuretoolbar button":{runMSAFeature:this.runMSAFeature,ShowDownloadFasta:this.ShowDownloadFasta,callIDMapping:this.runIDMapping,resetColumnState:this.resetColumnState},"featuretoolbar menuitem":{downloadGrid:this.downloadGrid}})},runMSAFeature:function(a){Ext.Ajax.request({url:"/portal/portal/patric/FIGfamSorter/FigFamSorterWindow?action=b&cacheability=PAGE",method:"POST",params:{featureIds:a,callType:"toAligner"},success:function(b,c){document.location.href="TreeAlignerB?cType=&cId=&pk="+b.responseText}})},runIDMapping:function(b,a){Ext.Ajax.request({url:"/portal/portal/patric/IDMapping/IDMappingWindow?action=b&cacheability=PAGE",method:"POST",params:{keyword:a,from:"PATRIC ID",to:b,sraction:"save_params"},success:function(c,d){document.location.href="IDMapping?cType=&cId=&dm=result&pk="+c.responseText+"#key="+Math.floor(Math.random()*10001)+"&pS=20&aP=1&dir=ASC&sort=genome_name,accession,start_max"}})},ShowDownloadFasta:function(c,b,a){Ext.getDom("fTableForm").action="/patric-common/jsp/fasta_download_handler.jsp";Ext.getDom("fastaaction").value=c;Ext.getDom("fastascope").value="Selected";Ext.getDom("fastatype").value=b;Ext.getDom("fids").value=a;if(c=="display"){window.open("","disp","width=920,height=400,scrollbars,resizable");Ext.getDom("fTableForm").target="disp"}else{Ext.getDom("fTableForm").target=""}Ext.getDom("fTableForm").submit()},downloadGrid:function(b){var c=new Array();var a=Ext.getStore("Features");Ext.Array.each(a.getRange(),function(d){c.push(d.internalId)});Ext.getDom("fTableForm").action="/patric-searches-and-tools/jsp/grid_download_handler.jsp";Ext.getDom("fTableForm").target="";Ext.getDom("tablesource").value="Workspace";Ext.getDom("fileformat").value=b;Ext.getDom("fids").value=c.join(",");Ext.getDom("idType").value="Feature";Ext.getDom("fTableForm").submit()},resetColumnState:function(){var a="/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=HTTPProvider";var b="&action=remove&name=featurelist";Ext.Ajax.request({url:a+b,method:"GET",success:function(c,d){}})}});Ext.define("VBI.Workspace.controller.Genome",{extend:"Ext.app.Controller",init:function(){this.control({"genometoolbar menuitem":{downloadGrid:this.downloadGrid},"genometoolbar button":{resetColumnState:this.resetColumnState}})},downloadGrid:function(b){var c=new Array(),a=Ext.getStore("Genomes");Ext.Array.each(a.getRange(),function(d){c.push(d.internalId)});Ext.getDom("fTableForm").action="/patric-searches-and-tools/jsp/grid_download_handler.jsp";Ext.getDom("fTableForm").target="";Ext.getDom("tablesource").value="Workspace";Ext.getDom("fileformat").value=b;Ext.getDom("fids").value=c.join(",");Ext.getDom("idType").value="Genome";Ext.getDom("fTableForm").submit()},resetColumnState:function(){var a="/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=HTTPProvider";var b="&action=remove&name=genomelist";Ext.Ajax.request({url:a+b,method:"GET",success:function(c,d){}})}});Ext.define("VBI.Workspace.controller.GlobalToolbar",{extend:"Ext.app.Controller",init:function(){this.control({"globaltoolbar button":{switchToListView:this.onSwitchToListView,switchToGroupView:this.onSwitchToGroupView}})},onSwitchToListView:function(b,c){var a=Ext.getCmp("workspace_view");a.applyState({activeItem:"listview"});a.getLayout().setActiveItem("listview")},onSwitchToGroupView:function(b,c){var a=Ext.getCmp("workspace_view");a.applyState({activeItem:"groupview"});a.getLayout().setActiveItem("groupview")}});Ext.define("VBI.Workspace.controller.Group",{extend:"Ext.app.Controller",init:function(){this.control({"grouptoolbar button":{runGroupExplorer:this.runGroupExplorer},groupbrowser:{itemdblclick:this.switchToGroupViewer},"detailtoolbar > button":{click:this.switchToBrowser},"groupinfoeditor > button":{click:this.toggleEditorFields},detailview:{viewExpDetail:this.viewExperimentDetail}})},runGroupExplorer:function(b,a){document.location.href="/portal/portal/patric/GroupManagement?mode=gse&groupType="+a+"&groupId="+b},switchToGroupViewer:function(h,d,i,f,g,j){var b=Ext.getCmp("workspace_detailview");b.child("#panel_info").getLayout().setActiveItem("groupinfo");var a=Ext.getStore("Mappings");a.setTrackFilter("Group",d.getId());a.setTrackFilter("String",null);var c=a.getFilteredTracks();if(d.get("type")=="Feature"){b.child("#panel_toolbar").getLayout().setActiveItem("feature");b.child("#panel_grid").getLayout().setActiveItem("featureview");Ext.getStore("Features").filterByTracks(c);Ext.getCmp("workspace_groupinfoeditor").loadRecord(d)}else{if(d.get("type")=="Genome"){b.child("#panel_toolbar").getLayout().setActiveItem("genome");b.child("#panel_grid").getLayout().setActiveItem("genomeview");Ext.getStore("Genomes").filterByTracks(c);Ext.getCmp("workspace_groupinfoeditor").loadRecord(d)}else{if(d.get("type")=="ExpressionExperiment"){b.child("#panel_toolbar").getLayout().setActiveItem("experiment");b.child("#panel_grid").getLayout().setActiveItem("experimentview");Ext.getStore("ExpressionExperiments").filterByTracks(c);Ext.getCmp("workspace_groupinfoeditor").loadRecord(d)}}}Ext.getCmp("workspace_view").getLayout().setActiveItem("detailview")},viewExperimentDetail:function(b){var c=Ext.getCmp("workspace_detailview");c.child("#panel_info").getLayout().setActiveItem("experimentinfo");c.child("#panel_toolbar").getLayout().setActiveItem("sample");c.child("#panel_grid").getLayout().setActiveItem("experimentdetail");Ext.getStore("ExpressionSamples").getProxy().setExtraParam("expid",b);if(typeof b=="number"){Ext.getStore("ExpressionSamples").getProxy().setExtraParam("expsource","PATRIC")}else{Ext.getStore("ExpressionSamples").getProxy().setExtraParam("expsource","User")}Ext.getStore("ExpressionSamples").load();var a=Ext.getStore("ExpressionExperiments").getById(b);Ext.getCmp("workspace_experimentinfoeditor").loadRecord(a);Ext.getCmp("workspace_view").getLayout().setActiveItem("detailview")},switchToBrowser:function(b,c,a){},toggleEditorFields:function(b,c,a){var d=b.findParentByType("groupinfoeditor");b.pressed?d.startEdit():d.finishEdit()}});Ext.define("VBI.Workspace.controller.Station",{extend:"Ext.app.Controller",init:function(){this.control({stationslist:{itemclick:this.onStationSelect}})},onStationSelect:function(l,h,n,i,j,q){var p=h.get("type");if(p==""){return false}var b=Ext.getStore("Mappings");var c=Ext.getStore("ColumnBrowser.Groups");var g=Ext.getStore("ColumnBrowser.Tags");var o=Ext.getStore("Features");var m=Ext.getStore("Genomes");var a=Ext.getStore("Groups");var k=Ext.getStore("ExpressionExperiments");c.clearFilter();c.filter("type",p);var f=new Array();Ext.Array.each(c.getRange(),function(e){f.push(e.get("tagId"))});b.setTrackFilter("Group",f);b.setTrackFilter("String",null);var d=b.getFilteredTracks();if(p==="Feature"){if(f.length>0){o.filterByTracks(d)}this.showListPanel("featureview")}else{if(p==="Genome"){if(f.length>0){m.filterByTracks(d)}this.showListPanel("genomeview")}else{if(p==="ExpressionExperiment"){if(f.length>0){k.filterByTracks(d)}this.showListPanel("experimentview")}}}var f=b.getTagsByTrack(d);g.filterByTag(f);Ext.getCmp("columnbrowser_groups").getSelectionModel().deselectAll();Ext.getCmp("columnbrowser_tags").getSelectionModel().deselectAll();a.clearFilter();a.filter("type",p)},showListPanel:function(a){Ext.getCmp("workspace_view").getLayout().setActiveItem(Ext.getCmp("workspace_view").activeItem);Ext.getCmp("workspace_listview").getLayout().setActiveItem(a)}});Ext.Loader.setConfig({enabled:true});Ext.application({name:"VBI.Workspace",autoCreateViewport:true,init:function(){},launch:function(){var a=new Ext.util.DelayedTask(function(){Ext.getCmp("workspace_station").setDefault("Features");Ext.getCmp("workspace_globaltoolbar").switchViewButtons()});a.delay(500);Ext.fly(document.body).setStyle("overflow","auto")},id:"workspace",models:["ColumnBrowser","Station","Feature","Genome","Group"],stores:["ColumnBrowser","ColumnBrowser.Groups","ColumnBrowser.Tags","Stations","Features","Genomes","Groups","Mappings","ExpressionExperiments","ExpressionSamples"],controllers:["ColumnBrowser","Station","Feature","Genome","Group","GlobalToolbar","Experiment"]});Date.prototype.getDayOfYear=function(){var a={1:31,2:28,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};if((this.getFullYear()-1900)%4==0){a[2]=29}var c=this.getDate();var b=this.getMonth()-1;while(b>0){c+=a[b];b--}return c};Ext.Date.formatFunctions["x-date-relative"]=formatRelativeDate;function formatRelativeDate(i){var i=this;var a=Ext.Date.getElapsed(i);var e=Ext.Date.format(i,"M j, Y");var f=Ext.Date.format(i,"g:i a");if(a<60000){return"A few seconds ago"}if(a<3000000){return"A few minutes ago"}if(a<4200000){return"About an hour ago"}var d=Ext.Date.format(i,"d F, Y H:i:s");var c=new Date(Ext.Date.format(i,"d F, Y H:i:s"));var b=new Date();var j=b.getDayOfYear()-c.getDayOfYear();var g=Math.floor(j/7);var h=(b.getDayOfYear()-c.getDayOfYear())%7;if(b.getFullYear()-c.getFullYear()>0){return e}if(b.getMonth()==c.getMonth()&&b.getDate()==c.getDate()){return"Today at "+f}if(b.getMonth()==c.getMonth()&&b.getDate()-c.getDate()==1){return"Yesterday at "+f}if(g==0||(g==1&&h==0)){return"Last "+Ext.Date.format(i,"l")}if(j<11){return j+" days ago"}if(g<7&&h==0){return g+" weeks ago"}if(g<7&&h<4){return"About "+g+" weeks ago"}if(g<7&&h>3){return"About "+(g+1)+" weeks ago"}return e}function BasicRenderer(e,d,a,f,c,b){d.tdAttr='data-qtip="'+e+'" data-qclass="x-tip"';return e}function launchExperimentDetail(a){Ext.getCmp("workspace_detailview").fireEvent("viewExpDetail",a)};